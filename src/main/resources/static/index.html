<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingaNora - Next Gen</title>
    
    <!-- IcÃ´nes et Polices Modernes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            /* Palette Moderne & Vibrante */
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --primary-solid: #6366f1;
            --secondary-bg: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.5);
            --text-main: #1e293b;
            --text-light: #64748b;
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02);
            --radius-lg: 24px;
            --radius-md: 16px;
        }
        
        * {
            box-sizing: border-box;
            outline: none;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f1f5f9;
            /* Fond abstrait moderne */
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,0) 0, hsla(253,16%,7%,0) 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,0) 0, hsla(225,39%,30%,0) 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,0) 0, hsla(339,49%,30%,0) 50%);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%236366f1' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            margin: 0; 
            height: 100vh;
            overflow: hidden;
            color: var(--text-main);
        }
        
        /* --- Header Design --- */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 32px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: var(--shadow-sm);
            z-index: 100;
            position: relative;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-main);
            font-size: 20px;
            font-weight: 700;
            font-family: 'Outfit', sans-serif;
            letter-spacing: -0.5px;
        }
        
        .logo i {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 26px;
        }
        
        /* --- Tabs Modernes --- */
        .tabs {
            display: flex;
            gap: 6px;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .tab {
            padding: 8px 20px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: transparent;
        }
        
        .tab.active {
            color: var(--primary-solid);
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .tab:hover:not(.active) {
            color: var(--text-main);
            background: rgba(255,255,255,0.5);
        }
        
        /* --- Layout Container --- */
        .container {
            display: flex;
            height: calc(100vh - 74px);
            background: transparent;
        }
        
        /* --- Translation Area --- */
        .translation-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px 40px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* --- Controls & Selectors --- */
        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        
        .lang-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .lang-select {
            padding: 8px 32px 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            background-color: transparent;
            color: var(--text-main);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            transition: color 0.2s;
        }
        
        .lang-select:hover {
            color: var(--primary-solid);
        }
        
        .swap-btn {
            background: var(--secondary-bg);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .swap-btn:hover {
            background: var(--primary-solid);
            color: white;
            transform: rotate(180deg) scale(1.1);
        }
        
        /* --- Translation Boxes (The Cards) --- */
        .translation-boxes {
            display: flex;
            flex: 1;
            border: none; 
            border-radius: var(--radius-lg);
            overflow: visible;
            background: transparent;
            box-shadow: none;
            gap: 24px; 
        }
        
        .translation-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 300px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255,255,255,0.8);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .translation-box:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .translation-box:first-child {
            border-right: 1px solid rgba(255,255,255,0.8);
        }
        
        .box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid #f1f5f9;
            background-color: transparent;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .box-lang {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            color: #94a3b8;
        }
        
        .detected-lang {
            color: var(--primary-solid);
            font-weight: 600;
            background: rgba(99, 102, 241, 0.1);
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
            font-size: 12px;
        }
        
        .box-tools {
            display: flex;
            gap: 4px;
        }
        
        .tool-btn {
            background: transparent;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.2s;
        }
        
        .tool-btn:hover {
            background-color: #f1f5f9;
            color: var(--primary-solid);
            transform: scale(1.05);
        }
        
        .box-content {
            flex: 1;
            padding: 24px;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        textarea {
            flex: 1;
            border: none;
            resize: none;
            font-size: 18px;
            line-height: 1.6;
            color: var(--text-main);
            font-family: inherit;
            outline: none;
            background: transparent;
            font-weight: 400;
        }
        
        textarea.rtl-arabic {
            direction: rtl;
            text-align: right;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        textarea::placeholder {
            color: #cbd5e1;
            font-weight: 300;
        }
        
        .box-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-top: 1px solid #f1f5f9;
            background: #fafafa;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }
        
        .char-count {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 500;
        }
        
        /* --- Buttons Design --- */
        .file-options {
            display: flex;
            gap: 10px;
        }
        
        .file-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        
        .file-btn:hover {
            background-color: white;
            border-color: var(--primary-solid);
            color: var(--primary-solid);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.15);
        }
        
        .file-btn i {
            color: var(--primary-solid);
        }

        .file-upload {
            display: none;
        }
        
        /* --- Image Area --- */
        .image-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: none;
            flex-direction: column;
            padding: 20px;
            z-index: 10;
            overflow: auto;
            border-radius: var(--radius-md);
        }

        .image-container.active {
            display: flex;
        }
        
        .image-frame {
            width: 100%;
            height: 350px;
            border: 2px dashed #cbd5e1;
            background: #f8fafc;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 16px;
            position: relative;
            transition: all 0.3s;
        }
        
        .image-frame:hover {
            border-color: var(--primary-solid);
            background: #f1f5f9;
        }
        
        .uploaded-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            padding: 8px;
        }

        .no-image-text {
            color: var(--text-light);
            font-size: 16px;
            text-align: center;
            padding: 30px 20px;
        }
        
        .no-image-text .fa-image {
            color: #94a3b8 !important;
            font-size: 3em;
            margin-bottom: 16px;
        }
        
        .image-text {
            border: none;
            background: #f8fafc;
            padding: 16px;
            border-radius: 12px;
            color: var(--text-main);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.03);
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 16px;
            font-size: 14px;
        }
        
        .image-text.rtl-arabic {
            direction: rtl;
            text-align: right;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .image-controls {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .clear-image-btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            background: #ef4444;
            color: white;
            border: none;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
        }
        
        .clear-image-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        /* --- Chatbot Tab --- */
        .chat-container {
            display: flex;
            flex-direction: column;
            background: white;
            border: none;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 0 auto;
            height: 100%;
            width: 100%;
            max-width: 1000px;
            /* Ajout pour limiter la hauteur et garder les tabs visibles */
            max-height: calc(100vh - 140px);
        }

        .chat-header-info {
            padding: 16px;
            background: var(--primary-gradient);
            color: white;
            font-size: 15px;
            font-weight: 600;
            text-align: center;
            border-bottom: none;
        }

        .chat-messages {
            flex: 1;
            padding: 24px;
            gap: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background-color: #f8fafc;
            /* Ajout pour limiter la hauteur des messages */
            max-height: calc(100% - 160px);
        }

        .message {
            max-width: 80%;
            padding: 14px 20px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .message.bot {
            align-self: flex-start;
            background-color: white;
            color: var(--text-main);
            border-bottom-left-radius: 4px;
            border: 1px solid #e2e8f0;
        }

        .message.user {
            align-self: flex-end;
            background: var(--primary-gradient);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message.rtl-arabic {
            direction: rtl;
            text-align: right;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #f1f5f9;
            display: flex;
            gap: 10px;
            align-items: center;
            /* Assurer que la zone de saisie reste toujours visible */
            flex-shrink: 0;
        }

        .chat-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 30px;
            font-size: 15px;
            background: #f8fafc;
            transition: all 0.2s;
            outline: none;
        }

        .chat-input:focus {
            background: white;
            border-color: var(--primary-solid);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .send-chat-btn {
            background: var(--primary-gradient);
            width: 46px;
            height: 46px;
            border-radius: 50%;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
            transition: all 0.2s;
        }

        .send-chat-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(99, 102, 241, 0.4);
        }
        
        .clear-chat-btn {
            border-radius: 20px;
            border-color: #e2e8f0;
            color: #ef4444;
        }
        
        .clear-chat-btn:hover {
            background: #fef2f2;
            border-color: #ef4444;
        }
        
        /* --- Sidebar History --- */
        .history-sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: -5px 0 25px rgba(0,0,0,0.05);
            display: none;
            flex-direction: column;
            height: 100vh; /* Full height */
            position: fixed; /* Fixed position */
            right: 0;
            top: 0;
            z-index: 200;
        }
        
        .history-sidebar.active {
            display: flex;
        }
        
        .history-header {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-header h3 {
            font-family: 'Outfit', sans-serif;
            color: var(--primary-solid);
            font-weight: 700;
            margin: 0;
            font-size: 18px;
        }
        
        .close-history {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 20px;
        }
        
        .history-tabs {
            display: flex;
            border-bottom: 1px solid #f1f5f9;
            background: white;
        }
        
        .history-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-light);
            cursor: pointer;
        }
        
        .history-tab.active {
            color: var(--primary-solid);
            border-bottom-color: var(--primary-solid);
        }
        
        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .history-item {
            background: white;
            border: 1px solid #f1f5f9;
            margin-bottom: 10px;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .history-item:hover {
            border-color: var(--primary-solid);
            transform: translateX(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .history-type {
            background: #e0e7ff;
            color: #4338ca;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .history-date {
            font-size: 11px;
            color: var(--text-light);
        }
        
        .history-text {
            font-size: 13px;
            color: var(--text-main);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .history-file-name {
            font-size: 13px;
            color: var(--text-main);
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .history-langs {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 6px;
        }
        
        .clear-history {
            padding: 16px;
            border-top: 1px solid #f1f5f9;
            background: white;
        }
        
        .clear-btn {
            width: 100%;
            padding: 12px;
            background: none;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .clear-btn:hover {
            background: #fef2f2;
            color: #ef4444;
            border-color: #ef4444;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* --- Responsive Tweaks --- */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
                min-height: calc(100vh - 74px);
            }
            
            .translation-boxes {
                flex-direction: column;
                gap: 16px;
            }
            
            .translation-box:first-child {
                border-right: 1px solid rgba(255,255,255,0.8);
            }
            
            .translation-area {
                padding: 16px;
            }
            
            .controls {
                width: 100%;
                justify-content: space-between;
                border-radius: 16px;
            }
            
            .history-sidebar {
                width: 100%;
                z-index: 300;
            }
            
            /* Ajustements pour le chatbot sur mobile */
            .chat-container {
                max-height: calc(100vh - 160px);
            }
            
            .chat-messages {
                max-height: calc(100% - 180px);
            }
        }

        /* Assurer la persistance complÃ¨te de l'apparence */
#inputText, #outputText {
    resize: vertical !important;
    transition: none !important;
    will-change: height, min-height;
}

/* EmpÃªcher les transitions qui pourraient perturber la restauration */
.translation-box, .box-content, .translation-area {
    transition: none !important;
}

/* Assurer que les conteneurs gardent leur structure */
.box-content {
    display: flex !important;
    flex-direction: column !important;
    flex: 1 !important;
}

.translation-box {
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    min-height: 400px !important;
}

.translation-boxes {
    display: flex !important;
    height: calc(100% - 80px) !important;
}

/* Garantir que les tailles sont prÃ©servÃ©es */
#inputText:focus, #outputText:focus {
    outline: none !important;
    box-shadow: none !important;
}

/* Styles pour conserver l'Ã©tat de l'image */
.image-container {
    transition: none !important;
}

.uploaded-image {
    max-width: 100% !important;
    max-height: 100% !important;
    object-fit: contain !important;
}
    </style>
</head>

<body>

<div class="header">
    <div class="header-left">
        <div class="logo">
            <i class="fas fa-language fa-lg"></i>
            <span>Traduction</span>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-tab="text">Texte</button>
            <button class="tab" data-tab="chatbot">Chatbot IA</button>
        </div>
    </div>
    
    <button class="tool-btn" id="historyBtn" title="Historique">
        <i class="fas fa-history"></i>
    </button>
</div>

<div class="container">
    <div class="translation-area" id="textTab">
        <div class="controls">
            <div class="lang-controls">
                <select class="lang-select" id="sourceLang">
                    <option value="auto">DÃ©tecter la langue</option>
                    <option value="fr">FranÃ§ais</option>
                    <option value="en">Anglais</option>
                    <option value="es">Espagnol</option>
                    <option value="ar">Arabe</option>
                    <option value="tr">Turc</option>
                </select>
                
                <button class="swap-btn" id="swapLangs" title="Ã‰changer les langues">
                    <i class="fas fa-exchange-alt"></i>
                </button>
                
                <select class="lang-select" id="targetLang">
                    <option value="en">Anglais</option>
                    <option value="fr">FranÃ§ais</option>
                    <option value="es">Espagnol</option>
                    <option value="ar">Arabe</option>
                    <option value="tr">Turc</option>
                </select>
            </div>
        </div>
        
        <div class="translation-boxes">
            <div class="translation-box">
                <div class="box-header">
                    <div>
                        <span class="box-lang" id="sourceLangLabel">FranÃ§ais</span>
                        <span class="detected-lang" id="detectedLangLabel"></span>
                    </div>
                    <div class="box-tools">
                        <button class="tool-btn" onclick="startDictation()" title="Saisie vocale">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="tool-btn" onclick="readText('inputText')" title="Ã‰couter">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <!-- BOUTON CROIX AJOUTÃ‰ -->
                        <button class="tool-btn" onclick="clearAllText()" title="Effacer tout le texte">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="box-content">
                    <textarea id="inputText" placeholder="Saisissez du texte"></textarea>
                    <div class="image-container" id="imageContainer">
                        <div class="image-frame" id="imageFrame">
                            <div class="no-image-text" id="noImageText">
                                <i class="fas fa-image fa-2x" style="margin-bottom: 8px; color: var(--text-secondary);"></i>
                                <p>Image tÃ©lÃ©chargÃ©e apparaÃ®tra ici</p>
                            </div>
                            <img id="uploadedImage" class="uploaded-image" src="" alt="Image tÃ©lÃ©chargÃ©e">
                        </div>
                        <div class="image-text" id="imageText">Texte extrait de l'image apparaÃ®tra ici...</div>
                        <div class="image-controls">
                            <button class="clear-image-btn" onclick="clearImage()">
                                <i class="fas fa-times"></i> Effacer l'image
                            </button>
                        </div>
                    </div>
                </div>
                <div class="box-footer">
                    <div class="char-count" id="charCount">0/5000</div>
                    <div class="file-options">
                        <label for="imgUpload" class="file-btn" title="Importer des images">
                            <i class="fas fa-image"></i>
                            <span>Importer</span>
                        </label>
                        <input type="file" id="imgUpload" class="file-upload" accept="image/*" onchange="uploadImage()">
                        
                        <label for="fileUpload" class="file-btn" title="Importer des documents">
                            <i class="fas fa-file-alt"></i>
                            <span>Documents</span>
                        </label>
                        <input type="file" id="fileUpload" class="file-upload" accept=".txt,.docx,.xlsx" onchange="uploadFile()">
                    </div>
                </div>
            </div>
            
            <div class="translation-box">
                <div class="box-header">
                    <div class="box-lang" id="targetLangLabel">Anglais</div>
                    <div class="box-tools">
                        <button class="tool-btn" onclick="readText('outputText')" title="Ã‰couter la traduction">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <button class="tool-btn" onclick="copyToClipboard()" title="Copier le texte">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div class="box-content">
                    <textarea id="outputText" readonly placeholder="Traduction"></textarea>
                </div>
                <div class="box-footer">
                    <div class="char-count" id="translatedCharCount">0 caractÃ¨res</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="translation-area" id="chatbotTab" style="display: none;">
        <div class="controls">
            <div class="lang-controls">
                <select class="lang-select" id="chatbotLang" onchange="updateChatbotLanguage()">
                    <option value="fr">FranÃ§ais</option>
                    <option value="en">Anglais</option>
                    <option value="es">Espagnol</option>
                    <option value="ar">Arabe</option>
                    <option value="tr">Turc</option>
                </select>
                <button class="file-btn" onclick="clearChat()" title="Effacer la conversation">
                    <i class="fas fa-trash-alt"></i>
                    <span>Effacer</span>
                </button>
            </div>
        </div>
        
        <div class="chat-container">
            <div class="chat-header-info" id="chatHeader">
                <i class="fas fa-robot"></i> Assistant IA intelligent - Discutez dans 5 langues !
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- Les messages seront ajoutÃ©s dynamiquement -->
            </div>
            
            <div class="chat-input-area">
                <input type="text" id="chatInput" class="chat-input" placeholder="Tapez votre message ici..." onkeypress="if(event.key === 'Enter') sendChatMessage()">
                <button class="send-chat-btn" onclick="sendChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- History Sidebar -->
    <div class="history-sidebar" id="historySidebar">
        <div class="history-header">
            <h3>Historique des traductions</h3>
            <button class="close-history" onclick="toggleHistory()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="history-tabs">
            <button class="history-tab active" data-history-tab="all">Tout</button>
            <button class="history-tab" data-history-tab="text">Texte</button>
            <button class="history-tab" data-history-tab="images">Images</button>
            <button class="history-tab" data-history-tab="documents">Documents</button>
        </div>
        
        <div class="history-list" id="historyList">
            <!-- Les Ã©lÃ©ments d'historique seront ajoutÃ©s ici dynamiquement -->
        </div>
        
        <div class="clear-history">
            <button class="clear-btn" onclick="clearHistory()">
                <i class="fas fa-trash-alt"></i>
                <span>Effacer l'historique</span>
            </button>
        </div>
    </div>
</div>

<!-- Download link (hidden) -->
<a id="downloadLink" style="display:none"></a>

<script>
    const detectedLangNames = {
        fr: 'FranÃ§ais',
        en: 'Anglais',
        es: 'Espagnol',
        ar: 'Arabe',
        tr: 'Turc'
    };

    let globalDetectedLang = null;
    let history = JSON.parse(localStorage.getItem('translationHistory')) || [];
    let currentHistoryTab = 'all';
    
    let chatHistory = [];
    let currentChatLanguage = 'fr';

    // ==========================================
    // NOUVELLE FONCTION POUR EFFACER TOUT LE TEXTE
    // ==========================================
    function clearAllText() {
        document.getElementById('inputText').value = '';
        document.getElementById('outputText').value = '';
        globalDetectedLang = null;
        updateDetectedLangDisplay();
        updateCharCount();
        document.getElementById('translatedCharCount').textContent = '0 caractÃ¨res';
        // Retirer la classe RTL lors du nettoyage
        document.getElementById('outputText').classList.remove('rtl-arabic');
        document.getElementById('inputText').classList.remove('rtl-arabic');
        // Ã€ la fin de clearAllText()
setTimeout(saveCompletePageState, 300);
    }

    // ==========================================
    // MODIFICATION DE LA FONCTION CLEARIMAGE
    // ==========================================
    function clearImage() {
        const imageContainer = document.getElementById('imageContainer');
        const uploadedImage = document.getElementById('uploadedImage');
        const noImageText = document.getElementById('noImageText');
        const inputTextarea = document.getElementById('inputText');
        const imageText = document.getElementById('imageText');
        
        imageContainer.classList.remove('active');
        inputTextarea.style.display = 'block';
        uploadedImage.src = '';
        uploadedImage.style.display = 'none';
        noImageText.style.display = 'flex';
        
        imageText.textContent = "";
        imageText.style.display = 'block';
        inputTextarea.value = '';
        document.getElementById('outputText').value = '';
        
        // RÃ‰INITIALISER LA LANGUE DÃ‰TECTÃ‰E
        globalDetectedLang = null;
        updateDetectedLangDisplay();
        
        updateCharCount();
        document.getElementById('translatedCharCount').textContent = '0 caractÃ¨res';
        
        // Retirer les classes RTL
        document.getElementById('outputText').classList.remove('rtl-arabic');
        document.getElementById('inputText').classList.remove('rtl-arabic');
        imageText.classList.remove('rtl-arabic');
        
        if (uploadedImage.src) {
            URL.revokeObjectURL(uploadedImage.src);
        }
    }

    // ==========================================
    // AJOUT DE LA TRADUCTION AUTOMATIQUE QUAND ON CHANGE LA LANGUE CIBLE
    // ==========================================
    document.getElementById('targetLang').addEventListener('change', function() {
        const inputText = document.getElementById('inputText').value;
        if (inputText && inputText.trim() !== '') {
            translateText();
        }
        // Appliquer le style RTL si la langue cible est l'arabe
        applyRTLStyles();
    });

    // ==========================================
    // FONCTION POUR APPLIQUER LES STYLES RTL
    // ==========================================
    function applyRTLStyles() {
        const targetLang = document.getElementById('targetLang').value;
        const sourceLang = document.getElementById('sourceLang').value;
        const outputTextarea = document.getElementById('outputText');
        const inputTextarea = document.getElementById('inputText');
        const imageText = document.getElementById('imageText');
        
        // Appliquer RTL pour la sortie si la langue cible est l'arabe
        if (targetLang === 'ar') {
            outputTextarea.classList.add('rtl-arabic');
        } else {
            outputTextarea.classList.remove('rtl-arabic');
        }
        
        // Appliquer RTL pour l'entrÃ©e si la langue source est l'arabe
        if (sourceLang === 'ar' || (sourceLang === 'auto' && globalDetectedLang === 'ar')) {
            inputTextarea.classList.add('rtl-arabic');
            if (imageText) imageText.classList.add('rtl-arabic');
        } else {
            inputTextarea.classList.remove('rtl-arabic');
            if (imageText) imageText.classList.remove('rtl-arabic');
        }
    }

    // ==========================================
    // TOUTES LES FONCTIONS EXISTANTES RESTENT IDENTIQUES
    // ==========================================
function updateChatbotLanguage() {
        const chatbotLang = document.getElementById('chatbotLang').value;
        currentChatLanguage = chatbotLang;
        
        const placeholders = {
            fr: "Tapez votre message ici...",
            en: "Type your message here...",
            es: "Escriba su mensaje aquÃ­...",
            ar: "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...",
            tr: "MesajÄ±nÄ±zÄ± buraya yazÄ±n..."
        };
        document.getElementById('chatInput').placeholder = placeholders[chatbotLang] || "Type your message here...";
        
        const headers = {
            fr: "Assistant IA intelligent - Discutez dans 5 langues !",
            en: "Smart AI Assistant - Chat in 5 languages!",
            es: "Asistente IA inteligente - Â¡Chatea en 5 idiomas!",
            ar: "Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Ø¯Ø±Ø¯Ø´ Ø¨Ù€ 5 Ù„ØºØ§Øª!",
            tr: "AkÄ±llÄ± AI AsistanÄ± - 5 dilde sohbet edin!"
        };
        document.getElementById('chatHeader').innerHTML = `<i class="fas fa-robot"></i> ${headers[chatbotLang] || headers.fr}`;
        
        // --- AJOUT : GESTION DE L'ALIGNEMENT ARABE (RTL) ---
        const chatInput = document.getElementById('chatInput');
        const allMessages = document.querySelectorAll('.message');
        
        if (chatbotLang === 'ar') {
            // Appliquer RTL Ã  l'input
            chatInput.style.direction = 'rtl';
            chatInput.style.textAlign = 'right';
            // Appliquer RTL aux messages existants
            allMessages.forEach(msg => msg.classList.add('rtl-arabic'));
        } else {
            // Revenir Ã  LTR pour les autres langues
            chatInput.style.direction = 'ltr';
            chatInput.style.textAlign = 'left';
            allMessages.forEach(msg => msg.classList.remove('rtl-arabic'));
        }
        // ----------------------------------------------------
        
        updateWelcomeMessage();
    }


    function updateWelcomeMessage() {
        const chatMessages = document.getElementById('chatMessages');
        const firstMessage = chatMessages.querySelector('.message.bot');
        
        if (firstMessage && firstMessage.textContent.includes('Bonjour') || 
            firstMessage && firstMessage.textContent.includes('Hello') ||
            firstMessage && firstMessage.textContent.includes('Hola') ||
            firstMessage && firstMessage.textContent.includes('Ù…Ø±Ø­Ø¨Ù‹Ø§') ||
            firstMessage && firstMessage.textContent.includes('Merhaba')) {
            
            const welcomeMessages = {
                fr: "ğŸ‘‹ Bonjour ! Je suis votre assistant IA spÃ©cialisÃ© en traduction. Je peux vous aider avec tout ce qui concerne les langues, la traduction de texte, d'images et de documents. Posez-moi vos questions !",
                en: "ğŸ‘‹ Hello! I'm your AI assistant specialized in translation. I can help you with everything related to languages, text translation, images, and documents. Ask me anything!",
                es: "ğŸ‘‹ Â¡Hola! Soy tu asistente de IA especializado en traducciÃ³n. Puedo ayudarte con todo lo relacionado con idiomas, traducciÃ³n de texto, imÃ¡genes y documentos. Â¡PregÃºntame lo que quieras!",
                ar: "ğŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙƒÙ„ Ù…Ø§ ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù„ØºØ§Øª ÙˆØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡!",
                tr: "ğŸ‘‹ Merhaba! Ben Ã§eviri konusunda uzmanlaÅŸmÄ±ÅŸ AI asistanÄ±nÄ±zÄ±m. Diller, metin Ã§evirisi, gÃ¶rÃ¼ntÃ¼ler ve belgelerle ilgili her konuda size yardÄ±mcÄ± olabilirim. Bana her ÅŸeyÙŠ sorabilirsiniz!"
            };
            
            firstMessage.textContent = welcomeMessages[currentChatLanguage] || welcomeMessages.fr;
        }
    }

    function addWelcomeMessage() {
        const welcomeMessages = {
            fr: "ğŸ‘‹ Bonjour ! Je suis votre assistant IA spÃ©cialisÃ© en traduction. Je peux vous aider avec tout ce qui concerne les langues, la traduction de texte, d'images et de documents. Posez-moi vos questions !",
            en: "ğŸ‘‹ Hello! I'm your AI assistant specialized in translation. I can help you with everything related to languages, text translation, images, and documents. Ask me anything!",
            es: "ğŸ‘‹ Â¡Hola! Soy tu asistente de IA especializado en traducciÃ³n. Puedo ayudarte con todo lo relacionado con idiomas, traducciÃ³n de texto, imÃ¡genes y documentos. Â¡PregÃºntame lo que quieras!",
            ar: "ğŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø©. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙƒÙ„ Ù…Ø§ ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù„ØºØ§Øª ÙˆØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡!",
            tr: "ğŸ‘‹ Merhaba! Ben Ã§eviri konusunda uzmanlaÅŸmÄ±ÅŸ AI asistanÄ±nÄ±zÄ±m. Diller, metin Ã§evirisi, gÃ¶rÃ¼ntÃ¼ler ve belgelerle ilgili her konuda size yardÄ±mcÄ± olabilirim. Bana her ÅŸeyÙŠ sorabilirsiniz!"
        };
        
        addMessageToChat(welcomeMessages[currentChatLanguage] || welcomeMessages.fr, 'bot');
    }

const knowledgeBase = {
        // --- CATÃ‰GORIES D'ORIGINE INTACTES ---
        greeting: {
            priority: 1,
            keywords: {
                fr: ['bonjour', 'salut', 'coucou', 'hello', 'bonsoir', 'bonjour\\b'],
                en: ['hello', 'hi', 'hey', 'good morning', 'good afternoon', 'hello\\b'],
                es: ['hola', 'buenos dÃ­as', 'buenas tardes', 'buenas noches', 'hola\\b'],
                ar: ['Ù…Ø±Ø­Ø¨Ø§', 'Ø£Ù‡Ù„Ø§', 'Ø³Ù„Ø§Ù…', 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±', 'Ù…Ø±Ø­Ø¨Ø§\\b'],
                tr: ['merhaba', 'selam', 'gÃ¼naydÄ±n', 'iyi gÃ¼nler', 'merhaba\\b']
            },
            responses: {
                fr: [
                    "Bonjour ! Comment puis-je vous aider avec vos traductions aujourd'hui ?",
                    "Salut ! PrÃªt Ã  traduire du texte, des images ou des documents ?",
                    "Bonjour ! Je suis lÃ  pour vous aider avec toutes vos questions sur la traduction."
                ],
                en: [
                    "Hello! How can I help you with your translations today?",
                    "Hi! Ready to translate text, images or documents?",
                    "Hello! I'm here to help you with all your translation questions."
                ],
                es: [
                    "Â¡Hola! Â¿CÃ³mo puedo ayudarte con tus traducciones hoy?",
                    "Â¡Hola! Â¿Listo para traducir texto, imÃ¡genes o documentos?",
                    "Â¡Hola! Estoy aquÃ­ para ayudarte con todas tus preguntas sobre traducciÃ³n."
                ],
                ar: [
                    "Ù…Ø±Ø­Ø¨Ø§! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ØªØ±Ø¬Ù…Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ",
                    "Ø£Ù‡Ù„Ø§! Ù…Ø³ØªØ¹Ø¯ Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ Ø£Ùˆ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§ØªØŸ",
                    "Ù…Ø±Ø­Ø¨Ø§! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ø³Ø¦Ù„ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø©."
                ],
                tr: [
                    "Merhaba! BugÃ¼n Ã§evirilerinizde size nasÄ±l yardÄ±mcÄ± olabilirim?",
                    "Selam! Metin, resim veya belgeleri Ã§evirmeye hazÄ±r mÄ±sÄ±nÄ±z?",
                    "Merhaba! TÃ¼m Ã§eviri sorularÄ±nÄ±zda size yardÄ±mcÄ± olmak iÃ§in buradayÄ±m."
                ]
            }
        },
        thanks: {
            priority: 1,
            keywords: {
                fr: ['merci', 'merci beaucoup', 'je te remercie', 'merci\\b'],
                en: ['thank you', 'thanks', 'thank', 'appreciate', 'thanks\\b'],
                es: ['gracias', 'agradezco', 'muchas gracias', 'gracias\\b'],
                ar: ['Ø´ÙƒØ±Ø§', 'Ø£Ø´ÙƒØ±Ùƒ', 'Ø´ÙƒØ±Ø§ Ø¬Ø²ÙŠÙ„Ø§', 'Ø´ÙƒØ±Ø§\\b'],
                tr: ['teÅŸekkÃ¼r ederim', 'saÄŸ ol', 'teÅŸekkÃ¼rler', 'teÅŸekkÃ¼r\\b']
            },
            responses: {
                fr: [
                    "De rien ! N'hÃ©sitez pas si vous avez d'autres questions sur la traduction.",
                    "Je vous en prie ! Continuez Ã  utiliser notre application de traduction.",
                    "Avec plaisir ! N'oubliez pas que je peux aussi vous aider avec les images et documents."
                ],
                en: [
                    "You're welcome! Don't hesitate if you have other translation questions.",
                    "My pleasure! Keep using our translation application.",
                    "You're welcome! Remember I can also help with images and documents."
                ],
                es: [
                    "Â¡De nada! No dudes si tienes otras preguntas sobre traducciÃ³n.",
                    "Â¡Es un placer! Sigue usando nuestra aplicaciÃ³n de traducciÃ³n.",
                    "Â¡De nada! Recuerda que tambiÃ©n puedo ayudar con imÃ¡genes y documentos."
                ],
                ar: [
                    "Ø¹ÙÙˆØ§! Ù„Ø§ ØªØªØ±Ø¯Ø¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø¦Ù„Ø© Ø£Ø®Ø±Ù‰ Ø­ÙˆÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø©.",
                    "Ø¨ÙƒÙ„ Ø³Ø±ÙˆØ±! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ù†Ø§.",
                    "Ø¹ÙÙˆÙ‹Ø§! ØªØ°ÙƒØ± Ø£Ù†Ù‡ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£ÙŠØ¶Ù‹Ø§ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª."
                ],
                tr: [
                    "Rica ederim! Ã‡eviriyle ilgili baÅŸka sorularÄ±nÄ±z varsa Ã§ekinmeyin.",
                    "Benim iÃ§in zevk! Ã‡eviri uygulamamÄ±zÄ± kullanmaya devam edin.",
                    "Rica ederim! GÃ¶rÃ¼ntÃ¼ler ve belgelerle de yardÄ±mcÄ± olabileceÄŸimi unutmayÄ±n."
                ]
            }
        },
        help: {
            priority: 2,
            keywords: {
                fr: ['aide', 'aider', 'comment', 'comment faire', 'aide-moi', 'aidez-moi', '\\baide\\b'],
                en: ['help', 'assist', 'how to', 'how do i', 'help me', '\\bhelp\\b'],
                es: ['ayuda', 'ayudar', 'cÃ³mo', 'cÃ³mo hacer', 'ayÃºdame', '\\bayuda\\b'],
                ar: ['Ù…Ø³Ø§Ø¹Ø¯Ø©', 'Ø³Ø§Ø¹Ø¯', 'ÙƒÙŠÙ', 'ÙƒÙŠÙ Ø£ÙØ¹Ù„', 'Ø³Ø§Ø¹Ø¯Ù†ÙŠ', 'Ù…Ø³Ø§Ø¹Ø¯Ø©\\b'],
                tr: ['yardÄ±m', 'yardÄ±m et', 'nasÄ±l', 'nasÄ±l yapÄ±lÄ±r', 'bana yardÄ±m et', 'yardÄ±m\\b']
            },
            responses: {
                fr: [
                    "Je peux vous aider avec :\n1. Traduction de texte dans 5 langues\n2. Traduction d'images avec OCR\n3. Traduction de documents (Word, Excel)\n4. Saisie vocale et synthÃ¨se vocale\n5. Historique des traductions\n\nQue souhaitez-vous faire ?",
                    "Notre application propose :\nâ€¢ Traduction instantanÃ©e\nâ€¢ Reconnaissance de texte dans les images\nâ€¢ Support de plusieurs formats de documents\nâ€¢ Interface multilingue\n\nDites-moi ce qui vous intÃ©resse !",
                    "Voici mes fonctionnalitÃ©s :\nâœ“ Traduire du texte entre 5 langues\nâœ“ Extraire et traduire du texte d'images\nâœ“ Traduire des documents entiers\nâœ“ Ã‰couter les traductions\nâœ“ Consulter l'historique\n\nComment puis-je vous aider spÃ©cifiquement ?"
                ],
                en: [
                    "I can help you with:\n1. Text translation in 5 languages\n2. Image translation with OCR\n3. Document translation (Word, Excel)\n4. Voice input and text-to-speech\n5. Translation history\n\nWhat would you like to do?",
                    "Our application offers:\nâ€¢ Instant translation\nâ€¢ Text recognition in images\nâ€¢ Multiple document format support\nâ€¢ Multilingual interface\n\nTell me what interests you!",
                    "Here are my features:\nâœ“ Translate text between 5 languages\nâœ“ Extract and translate text from images\nâœ“ Translate entire documents\nâœ“ Listen to translations\nâœ“ View history\n\nHow can I help you specifically?"
                ],
                es: [
                    "Puedo ayudarte con:\n1. TraducciÃ³n de texto en 5 idiomas\n2. TraducciÃ³n de imÃ¡genes con OCR\n3. TraducciÃ³n de documentos (Word, Excel)\n4. Entrada de voz y texto a voz\n5. Historial de traducciones\n\nÂ¿QuÃ© te gustarÃ­a hacer?",
                    "Nuestra application ofrece:\nâ€¢ TraducciÃ³n instantÃ¡nea\nâ€¢ Reconocimiento de texto en imÃ¡genes\nâ€¢ Soporte para mÃºltiples formatos de documentos\nâ€¢ Interfaz multilingÃ¼e\n\nÂ¡Dime quÃ© te interesa!",
                    "Estas son mis funciones:\nâœ“ Traducir texto entre 5 idiomas\nâœ“ Extraer y traducir texto de imÃ¡genes\nâœ“ Traducir documentos completos\nâœ“ Escuchar traducciones\nâœ“ Ver historial\n\nÂ¿CÃ³mo puedo ayudarte especÃ­ficamente?"
                ],
                ar: [
                    "ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:\n1. ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†Øµ Ø¨Ù€ 5 Ù„ØºØ§Øª\n2. ØªØ±Ø¬Ù…Ø© Ø§Ù„ØµÙˆØ± Ù…Ø¹ OCR\n3. ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (WordØŒ Excel)\n4. Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙˆØª ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…\n5. Ø³Ø¬Ù„ Ø§Ù„ØªØ±Ø¬Ù…Ø©\n\nÙ…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ØŸ",
                    "ÙŠÙ‚Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚Ù†Ø§:\nâ€¢ ØªØ±Ø¬Ù…Ø© ÙÙˆØ±ÙŠØ©\nâ€¢ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„ØµÙˆØ±\nâ€¢ Ø¯Ø¹Ù… ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©\nâ€¢ ÙˆØ§Ø¬Ù‡Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù„ØºØ§Øª\n\nØ£Ø®Ø¨Ø±Ù†ÙŠ Ø¨Ù…Ø§ ÙŠÙ‡Ù…Ùƒ!",
                    "Ù‡Ø§ Ù‡ÙŠ Ù…ÙŠØ²Ø§ØªÙŠ:\nâœ“ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†Øµ Ø¨ÙŠÙ† 5 Ù„ØºØ§Øª\nâœ“ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±\nâœ“ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©\nâœ“ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„Ù‰ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª\nâœ“ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„\n\nÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø¹Ù„Ù‰ ÙˆØ¬Ù‡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ØŸ"
                ],
                tr: [
                    "Size ÅŸu konularda yardÄ±mcÄ± olabilirim:\n1. 5 dilde metin Ã§evirisi\n2. OCR ile gÃ¶rÃ¼ntÃ¼ Ã§evirisi\n3. Belge Ã§evirisi (Word, Excel)\n4. Ses giriÅŸi ve metinden sese\n5. Ã‡eviri geÃ§miÅŸi\n\nNe yapmak istiyorsunuz?",
                    "UygulamamÄ±z ÅŸunlarÄ± sunar:\nâ€¢ AnÄ±nda Ã§eviri\nâ€¢ GÃ¶rÃ¼ntÃ¼lerde metin tanÄ±ma\nâ€¢ Birden Ã§ok belge formatÄ± desteÄŸi\nâ€¢ Ã‡ok dilli arayÃ¼z\n\nNeyle ilgilendiÄŸinizi sÃ¶yleyin!",
                    "Ä°ÅŸte Ã¶zelliklerim:\nâœ“ 5 dil arasÄ±nda metin Ã§evirisi\nâœ“ GÃ¶rÃ¼ntÃ¼lerden metin Ã§Ä±karma ve Ã§evirme\nâœ“ TÃ¼m belgeleri Ã§evirme\nâœ“ Ã‡evirileri dinleme\nâœ“ GeÃ§miÅŸi gÃ¶rÃ¼ntÃ¼leme\n\nSize Ã¶zellikle nasÄ±l yardÄ±mcÄ± olabilirim?"
                ]
            }
        },

        // --- NOUVELLES CATÃ‰GORIES "COMMENT FAIRE..." (PrioritÃ© 8 - TrÃ¨s haute) ---
        // Cette section rÃ©pond spÃ©cifiquement quand l'utilisateur demande "Comment..." + l'option
        
// --- PROCÃ‰DURES SPÃ‰CIFIQUES ET INTELLIGENTES (PrioritÃ© 8) ---
        
        procedure_image: {
            priority: 8,
            keywords: {
                fr: [
                    'comment traduire une image', 'comment traduire du texte depuis une image', 'procÃ©dure image', 'tuto image', 
                    'comment utiliser photo', 'mode d\'emploi ocr', 'comment Ã§a marche image', 
                    'guide photo', 'Ã©tapes image', 'traduire une capture'
                ],
                en: [
                    'how to translate an image', 'how to use photo', 'image procedure', 'steps for image', 
                    'how to ocr', 'image guide', 'photo tutorial', 'how does image work', 
                    'translate screenshot', 'using camera'
                ],
                es: [
                    'cÃ³mo traducir imagen', 'cÃ³mo funciona foto', 'procedimiento imagen', 'pasos imagen', 
                    'guÃ­a ocr', 'tutorial foto', 'cÃ³mo usar cÃ¡mara', 'traducir captura'
                ],
                ar: [
                    'ÙƒÙŠÙ ØªØªØ±Ø¬Ù… ØµÙˆØ±Ø©', 'ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØµÙˆØ±Ø©', 'Ø®Ø·ÙˆØ§Øª ØµÙˆØ±Ø©', 
                    'Ø¯Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±', 'Ø´Ø±Ø­ ocr', 'ÙƒÙŠÙ ØªØ¹Ù…Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§', 'ØªØ±Ø¬Ù…Ø© Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©'
                ],
                tr: [
                    'gÃ¶rÃ¼ntÃ¼ nasÄ±l Ã§evrilir', 'fotoÄŸraf nasÄ±l kullanÄ±lÄ±r', 'gÃ¶rÃ¼ntÃ¼ prosedÃ¼rÃ¼', 'fotoÄŸraf adÄ±mlarÄ±', 
                    'ocr kÄ±lavuzu', 'resim Ã§eviri nasÄ±l', 'ekran gÃ¶rÃ¼ntÃ¼sÃ¼ Ã§evir'
                ]
            },
            responses: {
                fr: [
                    "ğŸ“¸ **Mode d'emploi - Traduction d'Image (OCR)** :\n\n1. Restez dans l'onglet **Texte**.\n2. Cliquez sur le bouton **Importer** (icÃ´ne ğŸ–¼ï¸) situÃ© sous la zone de texte.\n3. SÃ©lectionnez votre image (JPG, PNG).\n4. Patientez quelques secondes : le texte sera extrait et traduit automatiquement Ã  l'Ã©cran !"
                ],
                en: [
                    "ğŸ“¸ **User Guide - Image Translation (OCR)**:\n\n1. Stay in the **Text** tab.\n2. Click the **Import** button (icon ğŸ–¼ï¸) below the text area.\n3. Select your image (JPG, PNG).\n4. Wait a few seconds: text will be extracted and translated automatically on screen!"
                ],
                es: [
                    "ğŸ“¸ **GuÃ­a de uso - TraducciÃ³n de ImÃ¡genes**:\n\n1. Mantente en la pestaÃ±a **Texto**.\n2. Haz clic en el botÃ³n **Importar** (icono ğŸ–¼ï¸) abajo.\n3. Selecciona tu imagen.\n4. Espera unos segundos: Â¡el texto se extraerÃ¡ y traducirÃ¡ automÃ¡ticamente!"
                ],
                ar: [
                    "ğŸ“¸ **Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - ØªØ±Ø¬Ù…Ø© Ø§Ù„ØµÙˆØ± (OCR)**:\n\n1. Ø§Ø¨Ù‚ ÙÙŠ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ **Ù†Øµ**.\n2. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± **Ø§Ø³ØªÙŠØ±Ø§Ø¯** (Ø£ÙŠÙ‚ÙˆÙ†Ø© ğŸ–¼ï¸) Ø£Ø³ÙÙ„ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Øµ.\n3. Ø§Ø®ØªØ± ØµÙˆØ±ØªÙƒ.\n4. Ø§Ù†ØªØ¸Ø± Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù: Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ ÙˆØªØ±Ø¬Ù…ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§!"
                ],
                tr: [
                    "ğŸ“¸ **KullanÄ±m KÄ±lavuzu - GÃ¶rÃ¼ntÃ¼ Ã‡evirisi**:\n\n1. **Metin** sekmesinde kalÄ±n.\n2. AÅŸaÄŸÄ±daki **Ä°Ã§e Aktar** dÃ¼ÄŸmesine (ğŸ–¼ï¸ simgesi) tÄ±klayÄ±n.\n3. Resminizi seÃ§in.\n4. BirkaÃ§ saniye bekleyin: metin Ã§Ä±karÄ±lacak ve otomatik olarak Ã§evrilecektir!"
                ]
            }
        },

        procedure_document: {
            priority: 8,
            keywords: {
                fr: [
                    'comment traduire un document', 'comment faire fichier', 'procÃ©dure document', 'tuto excel', 
                    'comment utiliser word', 'mode d\'emploi fichier', 'comment Ã§a marche document', 
                    'guide pdf', 'Ã©tapes fichier', 'traduire un docx'
                ],
                en: [
                    'how to translate a document', 'how to use file', 'document procedure', 'steps for excel', 
                    'how to word', 'file guide', 'document tutorial', 'how does file work', 
                    'translate docx', 'upload document'
                ],
                es: [
                    'cÃ³mo traducir documento', 'cÃ³mo funciona archivo', 'procedimiento documento', 'pasos excel', 
                    'guÃ­a word', 'tutorial archivo', 'cÃ³mo subir documento', 'traducir docx'
                ],
                ar: [
                    'ÙƒÙŠÙ ØªØªØ±Ø¬Ù… Ù…Ø³ØªÙ†Ø¯', 'ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù„ÙØ§Øª', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø³ØªÙ†Ø¯', 'Ø®Ø·ÙˆØ§Øª excel', 
                    'Ø¯Ù„ÙŠÙ„ word', 'Ø´Ø±Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª', 'ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯', 'ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù'
                ],
                tr: [
                    'belge nasÄ±l Ã§evrilir', 'dosya nasÄ±l kullanÄ±lÄ±r', 'belge prosedÃ¼rÃ¼', 'excel adÄ±mlarÄ±', 
                    'word kÄ±lavuzu', 'dosya Ã§eviri nasÄ±l', 'docx Ã§evir'
                ]
            },
            responses: {
                fr: [
                    "ğŸ“„ **Mode d'emploi - Traduction de Documents** :\n\n1. RepÃ©rez le bouton **Documents** (icÃ´ne ğŸ“„) sous la zone de saisie.\n2. Cliquez dessus et choisissez votre fichier (`.docx` ou `.xlsx`).\n3. La traduction se lance immÃ©diatement.\n4. Une fois terminÃ©e, le fichier traduit se **tÃ©lÃ©charge automatiquement** sur votre appareil."
                ],
                en: [
                    "ğŸ“„ **User Guide - Document Translation**:\n\n1. Locate the **Documents** button (icon ğŸ“„) below the input area.\n2. Click it and choose your file (`.docx` or `.xlsx`).\n3. Translation starts immediately.\n4. Once done, the translated file **downloads automatically** to your device."
                ],
                es: [
                    "ğŸ“„ **GuÃ­a de uso - Documentos**:\n\n1. Busca el botÃ³n **Documentos** (icono ğŸ“„) abajo.\n2. Haz clic y elige tu archivo (`.docx` o `.xlsx`).\n3. La traducciÃ³n comienza inmediatamente.\n4. Al finalizar, el archivo traducido se **descarga automÃ¡ticamente**."
                ],
                ar: [
                    "ğŸ“„ **Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª**:\n\n1. Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ Ø²Ø± **Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª** (Ø£ÙŠÙ‚ÙˆÙ†Ø© ğŸ“„) Ø£Ø³ÙÙ„ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„.\n2. Ø§Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡ ÙˆØ§Ø®ØªØ± Ù…Ù„ÙÙƒ (`.docx` Ø£Ùˆ `.xlsx`).\n3. ØªØ¨Ø¯Ø£ Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙÙˆØ±Ù‹Ø§.\n4. Ø¨Ù…Ø¬Ø±Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ØŒ ÙŠØªÙ… **ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ±Ø¬Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§**."
                ],
                tr: [
                    "ğŸ“„ **KullanÄ±m KÄ±lavuzu - Belge Ã‡evirisi**:\n\n1. GiriÅŸ alanÄ±nÄ±n altÄ±ndaki **Belgeler** dÃ¼ÄŸmesini (ğŸ“„ simgesi) bulun.\n2. TÄ±klayÄ±n ve dosyanÄ±zÄ± seÃ§in (`.docx` veya `.xlsx`).\n3. Ã‡eviri hemen baÅŸlar.\n4. BittiÄŸinde, Ã§evrilen dosya **otomatik olarak indirilir**."
                ]
            }
        },

        procedure_text: {
            priority: 8,
            keywords: {
                fr: [
                    'comment traduire un texte', 'comment Ã©crire', 'procÃ©dure texte', 'comment traduire du texte', 
                    'comment utiliser texte', 'mode d\'emploi texte', 'guide Ã©criture', 'Ã©tapes texte'
                ],
                en: [
                    'how to translate a text', 'how to write', 'text procedure', 'translation steps', 
                    'how to use text', 'text guide', 'writing tutorial', 'how to type'
                ],
                es: [
                    'cÃ³mo traducir texto', 'cÃ³mo escribir', 'procedimiento texto', 'pasos traducciÃ³n', 
                    'guÃ­a texto', 'tutorial escritura', 'cÃ³mo teclear'
                ],
                ar: [
                    'ÙƒÙŠÙ ØªØªØ±Ø¬Ù… Ù†Øµ', 'ÙƒÙŠÙ ØªÙƒØªØ¨', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Øµ', 'Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©', 
                    'Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ', 'Ø´Ø±Ø­ Ø§Ù„ÙƒØªØ§Ø¨Ø©', 'ÙƒÙŠÙÙŠØ© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©'
                ],
                tr: [
                    'metin nasÄ±l Ã§evrilir', 'nasÄ±l yazÄ±lÄ±r', 'metin prosedÃ¼rÃ¼', 'Ã§eviri adÄ±mlarÄ±', 
                    'metin kÄ±lavuzu', 'yazma eÄŸitimi', 'nasÄ±l girilir'
                ]
            },
            responses: {
                fr: [
                    "âœï¸ **Mode d'emploi - Traduction de Texte** :\n\n1. SÃ©lectionnez les langues **Source** (gauche) et **Cible** (droite) via les menus dÃ©roulants.\n2. Cliquez dans la grande zone vide Ã  gauche.\n3. Tapez ou collez votre texte.\n4. La traduction s'affiche **instantanÃ©ment** Ã  droite. Vous pouvez ensuite la copier ou l'Ã©couter !"
                ],
                en: [
                    "âœï¸ **User Guide - Text Translation**:\n\n1. Select **Source** (left) and **Target** (right) languages via dropdowns.\n2. Click inside the large empty box on the left.\n3. Type or paste your text.\n4. Translation appears **instantly** on the right. You can then copy or listen to it!"
                ],
                es: [
                    "âœï¸ **GuÃ­a de uso - Texto**:\n\n1. Selecciona los idiomas arriba.\n2. Haz clic en el Ã¡rea vacÃ­a de la izquierda.\n3. Escribe o pega tu texto.\n4. La traducciÃ³n aparece **al instante** a la derecha."
                ],
                ar: [
                    "âœï¸ **Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ**:\n\n1. Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ§Øª **Ø§Ù„Ù…ØµØ¯Ø±** (ÙŠØ³Ø§Ø±) Ùˆ **Ø§Ù„Ù‡Ø¯Ù** (ÙŠÙ…ÙŠÙ†) Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù….\n2. Ø§Ù†Ù‚Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„ÙØ§Ø±Øº Ø§Ù„ÙƒØ¨ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±.\n3. Ø§ÙƒØªØ¨ Ù†ØµÙƒ Ø£Ùˆ Ø§Ù„ØµÙ‚Ù‡.\n4. ØªØ¸Ù‡Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø© **ÙÙˆØ±ÙŠÙ‹Ø§** Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†. ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø®Ù‡Ø§ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„ÙŠÙ‡Ø§!"
                ],
                tr: [
                    "âœï¸ **KullanÄ±m KÄ±lavuzu - Metin Ã‡evirisi**:\n\n1. Ãœstten dilleri seÃ§in.\n2. Soldaki boÅŸ alana tÄ±klayÄ±n.\n3. Metninizi yazÄ±n veya yapÄ±ÅŸtÄ±rÄ±n.\n4. Ã‡eviri saÄŸda **anÄ±nda** gÃ¶rÃ¼nÃ¼r."
                ]
            }
        },

        procedure_audio: {
            priority: 8,
            keywords: {
                fr: [
                    "comment utiliser l'option audio", 'comment parler', 'procÃ©dure voix', 'comment utiliser audio', 
                    'mode d\'emploi audio', 'comment Ã©couter', 'guide vocal', 'Ã©tapes dictÃ©e', 'synthÃ¨se vocale'
                ],
                en: [
                    'how to use audio', 'how to speak', 'voice procedure', 'mic tutorial', 
                    'audio guide', 'how to listen', 'voice steps', 'dictation guide', 'speech to text'
                ],
                es: [
                    'cÃ³mo usar audio', 'cÃ³mo hablar', 'procedimiento voz', 'tutorial micro', 
                    'guÃ­a audio', 'cÃ³mo escuchar', 'pasos dictado'
                ],
                ar: [
                    'ÙƒÙŠÙ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„ØµÙˆØª', 'ÙƒÙŠÙ ØªØªØ­Ø¯Ø«', 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØµÙˆØª', 'Ø´Ø±Ø­ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†', 
                    'Ø¯Ù„ÙŠÙ„ ØµÙˆØªÙŠ', 'ÙƒÙŠÙ ØªØ³ØªÙ…Ø¹', 'Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡'
                ],
                tr: [
                    'ses nasÄ±l kullanÄ±lÄ±r', 'nasÄ±l konuÅŸulur', 'ses prosedÃ¼rÃ¼', 'mikrofon kÄ±lavuzu', 
                    'ses rehberi', 'nasÄ±l dinlenir', 'dikte adÄ±mlarÄ±'
                ]
            },
            responses: {
                fr: [
                    "ğŸ¤ **Mode d'emploi - Audio & Voix** :\n\nâ€¢ **Pour Parler (DictÃ©e)** : Cliquez sur l'icÃ´ne **Microphone** (ğŸ¤) et parlez distinctement. L'IA Ã©crira et traduira ce que vous dites.\nâ€¢ **Pour Ã‰couter** : Cliquez sur l'icÃ´ne **Haut-parleur** (ğŸ”‰) dans la zone de texte ou de traduction pour entendre la prononciation."
                ],
                en: [
                    "ğŸ¤ **User Guide - Audio & Voice**:\n\nâ€¢ **To Speak (Dictation)**: Click the **Microphone** icon (ğŸ¤) and speak clearly. AI will type and translate what you say.\nâ€¢ **To Listen**: Click the **Speaker** icon (ğŸ”‰) in either box to hear the pronunciation."
                ],
                es: [
                    "ğŸ¤ **GuÃ­a de uso - Audio**:\n\nâ€¢ **Hablar**: Haz clic en el **MicrÃ³fono** (ğŸ¤) y habla. La IA escribirÃ¡ y traducirÃ¡.\nâ€¢ **Escuchar**: Haz clic en el **Altavoz** (ğŸ”‰) para oÃ­r la pronunciaciÃ³n."
                ],
                ar: [
                    "ğŸ¤ **Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - Ø§Ù„ØµÙˆØª**:\n\nâ€¢ **Ù„Ù„ØªØ­Ø¯Ø«**: Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© **Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†** (ğŸ¤) ÙˆØªØ­Ø¯Ø« Ø¨ÙˆØ¶ÙˆØ­.\nâ€¢ **Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹**: Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© **Ù…ÙƒØ¨Ø± Ø§Ù„ØµÙˆØª** (ğŸ”‰) Ù„Ø³Ù…Ø§Ø¹ Ø§Ù„Ù†Ø·Ù‚."
                ],
                tr: [
                    "ğŸ¤ **KullanÄ±m KÄ±lavuzu - Ses**:\n\nâ€¢ **KonuÅŸmak iÃ§in**: **Mikrofon** simgesine (ğŸ¤) tÄ±klayÄ±n ve konuÅŸun.\nâ€¢ **Dinlemek iÃ§in**: **HoparlÃ¶r** simgesine (ğŸ”‰) tÄ±klayÄ±n."
                ]
            }
        },

        // --- NOUVELLE CATÃ‰GORIE : FONCTIONNALITÃ‰S GLOBALES & SPÃ‰CIALITÃ‰S ---
        
        features: {
            priority: 7, // PrioritÃ© haute pour intercepter les questions gÃ©nÃ©rales
            keywords: {
                fr: [
                    'fonctionnalitÃ©s', 'fonctions', 'spÃ©cialitÃ©s', 'options', 'capacitÃ©s', 
                    'que fais-tu', 'que peux-tu faire', 'a quoi sers-tu', 'prÃ©sentation', 
                    'vue d\'ensemble', 'c\'est quoi cette application', 'menu principal',
                    'liste des options', 'tout ce que tu fais'
                ],
                en: [
                    'features', 'functionalities', 'specialties', 'functions', 'capabilities',
                    'what do you do', 'what can you do', 'what is this app', 'overview',
                    'main menu', 'list options', 'everything you do', 'app summary'
                ],
                es: [
                    'funcionalidades', 'funciones', 'especialidades', 'opciones', 'capacidades',
                    'quÃ© haces', 'quÃ© puedes hacer', 'para quÃ© sirves', 'presentaciÃ³n',
                    'resumen', 'quÃ© es esta aplicaciÃ³n', 'menÃº principal'
                ],
                ar: [
                    'Ù…ÙŠØ²Ø§Øª', 'ÙˆØ¸Ø§Ø¦Ù', 'ØªØ®ØµØµØ§Øª', 'Ø®ÙŠØ§Ø±Ø§Øª', 'Ù‚Ø¯Ø±Ø§Øª', 
                    'Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„', 'Ù…Ø§Ø°Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªÙØ¹Ù„', 'Ù…Ø§ Ù‡Ùˆ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'Ù„Ù…Ø­Ø© Ø¹Ø§Ù…Ø©',
                    'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª', 'ÙƒÙ„ Ø´ÙŠØ¡ ØªÙØ¹Ù„Ù‡', 'Ø´Ø±Ø­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'
                ],
                tr: [
                    'Ã¶zellikler', 'fonksiyonlar', 'uzmanlÄ±klar', 'seÃ§enekler', 'yetenekler',
                    'ne yaparsÄ±n', 'ne yapabilirsin', 'bu uygulama nedir', 'genel bakÄ±ÅŸ',
                    'ana menÃ¼', 'seÃ§enekler listesi', 'neler yapÄ±yorsun'
                ]
            },
            responses: {
                fr: [
                    "ğŸš€ **PrÃ©sentation de LingaNora - Next Gen**\n\nJe suis une plateforme de traduction IA complÃ¨te. Voici mes **5 spÃ©cialitÃ©s majeures** :\n\n1. âœï¸ **Traduction de Texte** : Traduction instantanÃ©e et prÃ©cise entre 5 langues.\n2. ğŸ–¼ï¸ **OCR Image** : J'extrais et traduis le texte directement depuis vos photos ou captures d'Ã©cran.\n3. ğŸ“„ **Documents Pro** : Je traduis des fichiers entiers (.docx, .xlsx) en conservant leur mise en forme originale.\n4. ğŸ¤ **Mode Vocal** : DictÃ©e vocale (Speech-to-Text) et lecture des traductions (Text-to-Speech).\n5. ğŸ¤– **Assistant Chatbot** : Je suis lÃ  pour vous guider et rÃ©pondre Ã  vos questions contextuelles.\n\n*Quelle fonctionnalitÃ© souhaitez-vous tester ?*"
                ],
                en: [
                    "ğŸš€ **LingaNora - Next Gen Overview**\n\nI am a complete AI translation platform. Here are my **5 major specialties**:\n\n1. âœï¸ **Text Translation**: Instant and accurate translation between 5 languages.\n2. ğŸ–¼ï¸ **Image OCR**: I extract and translate text directly from your photos or screenshots.\n3. ğŸ“„ **Pro Documents**: I translate entire files (.docx, .xlsx) while keeping their original formatting.\n4. ğŸ¤ **Voice Mode**: Voice dictation (Speech-to-Text) and audio playback (Text-to-Speech).\n5. ğŸ¤– **Chatbot Assistant**: I am here to guide you and answer your contextual questions.\n\n*Which feature would you like to try?*"
                ],
                es: [
                    "ğŸš€ **PresentaciÃ³n de LingaNora**\n\nSoy una plataforma completa de traducciÃ³n por IA. AquÃ­ estÃ¡n mis **5 especialidades principales**:\n\n1. âœï¸ **TraducciÃ³n de Texto**: InstantÃ¡nea entre 5 idiomas.\n2. ğŸ–¼ï¸ **OCR de ImÃ¡genes**: Extraigo y traduzco texto directamente de tus fotos.\n3. ğŸ“„ **Documentos Pro**: Traduzco archivos completos (.docx, .xlsx) manteniendo el formato.\n4. ğŸ¤ **Modo de Voz**: Dictado y lectura de audio.\n5. ğŸ¤– **Asistente Chatbot**: Estoy aquÃ­ para guiarte.\n\n*Â¿QuÃ© funciÃ³n te gustarÃ­a probar?*"
                ],
                ar: [
                    "ğŸš€ **Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ LingaNora**\n\nØ£Ù†Ø§ Ù…Ù†ØµØ© ØªØ±Ø¬Ù…Ø© Ø´Ø§Ù…Ù„Ø© ØªØ¹Ù…Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. Ø¥Ù„ÙŠÙƒ **ØªØ®ØµØµØ§ØªÙŠ Ø§Ù„Ø®Ù…Ø³Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©**:\n\n1. âœï¸ **ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ**: ØªØ±Ø¬Ù…Ø© ÙÙˆØ±ÙŠØ© ÙˆØ¯Ù‚ÙŠÙ‚Ø© Ø¨ÙŠÙ† 5 Ù„ØºØ§Øª.\n2. ğŸ–¼ï¸ **ØªØ±Ø¬Ù…Ø© Ø§Ù„ØµÙˆØ± (OCR)**: Ø£Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù†Øµ ÙˆØ£ØªØ±Ø¬Ù…Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† ØµÙˆØ±Ùƒ.\n3. ğŸ“„ **Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª**: Ø£ØªØ±Ø¬Ù… Ù…Ù„ÙØ§Øª ÙƒØ§Ù…Ù„Ø© (.docx, .xlsx) Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚.\n4. ğŸ¤ **Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØµÙˆØªÙŠ**: Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡ Ø§Ù„ØµÙˆØªÙŠ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª.\n5. ğŸ¤– **Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ**: Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ø¥Ø±Ø´Ø§Ø¯Ùƒ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ.\n\n*Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„ØªÙŠ ØªÙˆØ¯ ØªØ¬Ø±Ø¨ØªÙ‡Ø§ØŸ*"
                ],
                tr: [
                    "ğŸš€ **LingaNora TanÄ±tÄ±mÄ±**\n\nBen kapsamlÄ± bir AI Ã§eviri platformuyum. Ä°ÅŸte **5 ana uzmanlÄ±ÄŸÄ±m**:\n\n1. âœï¸ **Metin Ã‡evirisi**: 5 dil arasÄ±nda anÄ±nda ve doÄŸru Ã§eviri.\n2. ğŸ–¼ï¸ **GÃ¶rÃ¼ntÃ¼ OCR**: FotoÄŸraflarÄ±nÄ±zdan metni Ã§Ä±karÄ±p Ã§eviririm.\n3. ğŸ“„ **Belgeler**: DosyalarÄ± (.docx, .xlsx) formatÄ± bozmadan Ã§eviririm.\n4. ğŸ¤ **Ses Modu**: Sesle yazma ve Ã§evirileri dinleme.\n5. ğŸ¤– **Chatbot AsistanÄ±**: Size rehberlik etmek iÃ§in buradayÄ±m.\n\n*Hangi Ã¶zelliÄŸi denemek istersiniz?*"
                ]
            }
        },

        // --- CATÃ‰GORIES D'OPTIONS (InchangÃ©es - PrioritÃ© 5) ---
        // Elles rÃ©pondent aux questions gÃ©nÃ©rales sur les fonctionnalitÃ©s (sans "comment")
        
        image: {
            priority: 5,
            keywords: {
                fr: ['image', 'photo', 'ocr', 'scanner', 'texte dans l\'image', 'capture', 'png', 'jpg', '\\bimage\\b'],
                en: ['image', 'photo', 'ocr', 'scan', 'text in image', 'screenshot', 'png', 'jpg', '\\bimage\\b'],
                es: ['imagen', 'foto', 'ocr', 'escanear', 'captura', 'png', 'jpg', '\\bimagen\\b'],
                ar: ['ØµÙˆØ±Ø©', 'ocr', 'Ù…Ø³Ø­', 'Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©', 'Ø¨Ù‰ Ø§Ù† Ø¬Ù‰', 'Ø¬ÙŠÙ‡ Ø¨Ù‰ Ø¬Ù‰', '\\bØµÙˆØ±Ø©\\b'],
                tr: ['gÃ¶rÃ¼ntÃ¼', 'fotoÄŸraf', 'ocr', 'tarama', 'ekran gÃ¶rÃ¼ntÃ¼sÃ¼', 'png', 'jpg', '\\bgÃ¶rÃ¼ntÃ¼\\b']
            },
            responses: {
                fr: [
                    "**FonctionnalitÃ© Image OCR** :\nJe peux extraire le texte de n'importe quelle image (JPG, PNG) et le traduire.\n*Pour savoir comment faire, demandez 'Comment traduire une image ?'*"
                ],
                en: [
                    "**Image OCR Feature**:\nI can extract text from any image (JPG, PNG) and translate it.\n*To know how, ask 'How to translate an image?'*"
                ],
                es: [
                    "**FunciÃ³n de Imagen OCR**:\nPuedo extraer texto de cualquier imagen y traducirlo.\n*Para saber cÃ³mo, pregunta 'Â¿CÃ³mo traducir una imagen?'*"
                ],
                ar: [
                    "**Ù…ÙŠØ²Ø© ØµÙˆØ±Ø© OCR**:\nÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø£ÙŠ ØµÙˆØ±Ø© ÙˆØªØ±Ø¬Ù…ØªÙ‡.\n*Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ÙƒÙŠÙÙŠØ©ØŒ Ø§Ø³Ø£Ù„ 'ÙƒÙŠÙ ØªØªØ±Ø¬Ù… ØµÙˆØ±Ø©ØŸ'*"
                ],
                tr: [
                    "**GÃ¶rÃ¼ntÃ¼ OCR Ã–zelliÄŸi**:\nHerhangi bir gÃ¶rÃ¼ntÃ¼den metin Ã§Ä±karabilir ve Ã§evirebilirim.\n*NasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in 'Bir gÃ¶rÃ¼ntÃ¼ nasÄ±l Ã§evrilir?' diye sorun.*"
                ]
            }
        },

        document: {
            priority: 5,
            keywords: {
                fr: ['document', 'fichier', 'excel', 'word', 'xlsx', '.docx', '.xlsx', '.txt', '\\bdocument\\b'],
                en: ['document', 'file', 'excel', 'word', 'xlsx', '.docx', '.xlsx', '.txt', '\\bdocument\\b'],
                es: ['documento', 'archivo', 'excel', 'word', 'xlsx', '.docx', '\\bdocumento\\b'],
                ar: ['Ù…Ø³ØªÙ†Ø¯', 'Ù…Ù„Ù', 'excel', 'word', 'xlsx', '.docx', '\\bÙ…Ø³ØªÙ†Ø¯\\b'],
                tr: ['belge', 'dosya', 'excel', 'word', 'xlsx', '.docx', '\\bbelge\\b']
            },
            responses: {
                fr: [
                    "**FonctionnalitÃ© Documents** :\nJe supporte les fichiers Excel (.xlsx) et Word (.docx) en conservant leur mise en forme.\n*Pour la procÃ©dure, demandez 'Comment traduire un document ?'*"
                ],
                en: [
                    "**Document Feature**:\nI support Excel (.xlsx) and Word (.docx) files while keeping their formatting.\n*For procedure, ask 'How to translate a document?'*"
                ],
                es: [
                    "**FunciÃ³n de Documentos**:\nSoporto archivos Excel y Word manteniendo su formato.\n*Para el procedimiento, pregunta 'Â¿CÃ³mo traducir un documento?'*"
                ],
                ar: [
                    "**Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª**:\nØ£Ù†Ø§ Ø£Ø¯Ø¹Ù… Ù…Ù„ÙØ§Øª Excel Ùˆ Word Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚Ù‡Ø§.\n*Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§ØªØŒ Ø§Ø³Ø£Ù„ 'ÙƒÙŠÙ ØªØªØ±Ø¬Ù… Ù…Ø³ØªÙ†Ø¯ØŸ'*"
                ],
                tr: [
                    "**Belge Ã–zelliÄŸi**:\nExcel ve Word dosyalarÄ±nÄ± biÃ§imlendirmelerini koruyarak destekliyorum.\n*ProsedÃ¼r iÃ§in 'Bir belge nasÄ±l Ã§evrilir?' diye sorun.*"
                ]
            }
        },

        translation: {
            priority: 3,
            keywords: {
                fr: ['traduire', 'traduction', 'langue', 'mot', 'phrase', '\\btraduire\\b', '\\btraduction\\b'],
                en: ['translate', 'translation', 'language', 'word', 'phrase', '\\btranslate\\b', '\\btranslation\\b'],
                es: ['traducir', 'traducciÃ³n', 'idioma', 'palabra', 'frase', '\\btraducir\\b', '\\btraducciÃ³n\\b'],
                ar: ['ØªØ±Ø¬Ù…Ø©', 'Ù„ØºØ©', 'ÙƒÙ„Ù…Ø©', 'Ø¬Ù…Ù„Ø©', 'ØªØ±Ø¬Ù…Ø©\\b', 'Ù„ØºØ©\\b'],
                tr: ['Ã§evirmek', 'Ã§eviri', 'dil', 'kelime', 'ifade', 'Ã§evirmek\\b', 'Ã§eviri\\b']
            },
            responses: {
                fr: [
                    "**Traduction de texte** :\nJe traduis instantanÃ©ment entre 5 langues.\n*Pour le mode d'emploi, demandez 'Comment traduire du texte ?'*"
                ],
                en: [
                    "**Text Translation**:\nI translate instantly between 5 languages.\n*For instructions, ask 'How to translate text?'*"
                ],
                es: [
                    "**TraducciÃ³n de texto**:\nTraduzco instantÃ¡neamente entre 5 idiomas.\n*Para instrucciones, pregunta 'Â¿CÃ³mo traducir texto?'*"
                ],
                ar: [
                    "**ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†Øµ**:\nØ£ØªØ±Ø¬Ù… ÙÙˆØ±Ù‹Ø§ Ø¨ÙŠÙ† 5 Ù„ØºØ§Øª.\n*Ù„Ù„ØªØ¹Ù„ÙŠÙ…Ø§ØªØŒ Ø§Ø³Ø£Ù„ 'ÙƒÙŠÙ ØªØªØ±Ø¬Ù… Ø§Ù„Ù†ØµØŸ'*"
                ],
                tr: [
                    "**Metin Ã‡evirisi**:\n5 dil arasÄ±nda anÄ±nda Ã§eviri yaparÄ±m.\n*Talimatlar iÃ§in 'Metin nasÄ±l Ã§evrilir?' diye sorun.*"
                ]
            }
        },

        audio: {
            priority: 5,
            keywords: {
                fr: ['audio', 'voix', 'microphone', 'Ã©couter', 'parler', 'synthÃ¨se vocale', 'lecture', 'dictÃ©e', 'micro'],
                en: ['audio', 'voice', 'microphone', 'listen', 'speak', 'text-to-speech', 'read', 'dictation', 'mic'],
                es: ['audio', 'voz', 'micrÃ³fono', 'escuchar', 'hablar', 'texto a voz', 'leer', 'dictado', 'mic'],
                ar: ['ØµÙˆØª', 'ØµÙˆØª', 'Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†', 'Ø§Ø³ØªÙ…Ø¹', 'ØªØ­Ø¯Ø«', 'Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù…', 'Ø§Ù‚Ø±Ø£', 'Ø¥Ù…Ù„Ø§Ø¡', 'Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†'],
                tr: ['ses', 'ses', 'mikrofon', 'dinle', 'konuÅŸ', 'metinden sese', 'oku', 'dikte', 'mikrofon']
            },
            responses: {
                fr: [
                    "**Audio & Voix** :\nJe dispose de la reconnaissance vocale et de la lecture audio.\n*Demandez 'Comment utiliser l'audio ?' pour plus de dÃ©tails.*"
                ],
                en: [
                    "**Audio & Voice**:\nI have voice recognition and audio playback.\n*Ask 'How to use audio?' for details.*"
                ],
                es: [
                    "**Audio y Voz**:\nTengo reconocimiento de voz y reproducciÃ³n de audio.\n*Pregunta 'Â¿CÃ³mo usar el audio?' para detalles.*"
                ],
                ar: [
                    "**Ø§Ù„ØµÙˆØª ÙˆØ§Ù„ÙƒÙ„Ø§Ù…**:\nÙ„Ø¯ÙŠ Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª.\n*Ø§Ø³Ø£Ù„ 'ÙƒÙŠÙ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„ØµÙˆØªØŸ' Ù„Ù„ØªÙØ§ØµÙŠÙ„.*"
                ],
                tr: [
                    "**Ses ve KonuÅŸma**:\nSes tanÄ±ma ve ses Ã§alma Ã¶zelliklerine sahibim.\n*AyrÄ±ntÄ±lar iÃ§in 'Ses nasÄ±l kullanÄ±lÄ±r?' diye sorun.*"
                ]
            }
        },
        
        file_types: {
            priority: 5,
            keywords: {
                fr: ['quels fichiers', 'types de fichiers', 'extensions', 'formats', 'format supportÃ©', 'pdf', 'docx', 'xlsx', 'jpeg', 'png'],
                en: ['what files', 'file types', 'extensions', 'formats', 'supported formats', 'pdf', 'docx', 'xlsx', 'jpeg', 'png'],
                es: ['quÃ© archivos', 'tipos de archivos', 'extensiones', 'formatos', 'formatos soportados', 'pdf'],
                ar: ['Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª', 'Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª', 'Ø§Ù…ØªØ¯Ø§Ø¯Ø§Øª', 'ØªÙ†Ø³ÙŠÙ‚Ø§Øª', 'ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¯Ø¹ÙˆÙ…', 'pdf'],
                tr: ['hangi dosyalar', 'dosya tÃ¼rleri', 'uzantÄ±lar', 'formatlar', 'desteklenen formatlar', 'pdf']
            },
            responses: {
                fr: [
                    "ğŸ“‚ **Formats supportÃ©s :**\n\nâ€¢ **Documents :** Word (`.docx`), Excel (`.xlsx`), Texte brut (`.txt`).\nâ€¢ **Images :** JPG, JPEG, PNG.\n\nNote : Les fichiers PDF ne sont pas supportÃ©s directement, mais les Excels et Words sont parfaitement traduits !",
                    "Vous pouvez importer des fichiers **Word (.docx)** et **Excel (.xlsx)** pour conserver la mise en forme, ou des fichiers **.txt**. Pour l'OCR, nous acceptons toutes les images standards (JPG/PNG)."
                ],
                en: [
                    "ğŸ“‚ **Supported Formats:**\n\nâ€¢ **Documents:** Word (`.docx`), Excel (`.xlsx`), Plain Text (`.txt`).\nâ€¢ **Images:** JPG, JPEG, PNG.\n\nNote: PDF files are not directly supported, but Excel and Word files are translated perfectly!",
                    "You can upload **Word (.docx)** and **Excel (.xlsx)** files to keep formatting, or **.txt** files. For OCR, we accept all standard images (JPG/PNG)."
                ],
                es: [
                    "ğŸ“‚ **Formatos soportados:**\n\nâ€¢ **Documentos:** Word (`.docx`), Excel (`.xlsx`), Texto simple (`.txt`).\nâ€¢ **ImÃ¡genes:** JPG, JPEG, PNG.\n\nNota: Los PDF no se soportan directamente, Â¡pero Excel y Word se traducen perfectamente!",
                    "Puedes subir archivos **Word (.docx)** y **Excel (.xlsx)** para mantener el formato, o archivos **.txt**."
                ],
                ar: [
                    "ğŸ“‚ **Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©:**\n\nâ€¢ **Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª:** Word (`.docx`)ØŒ Excel (`.xlsx`)ØŒ Ù†Øµ Ø¹Ø§Ø¯ÙŠ (`.txt`).\nâ€¢ **Ø§Ù„ØµÙˆØ±:** JPGØŒ JPEGØŒ PNG.\n\nÙ…Ù„Ø§Ø­Ø¸Ø©: Ù…Ù„ÙØ§Øª PDF ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ù„ÙƒÙ† ÙŠØªÙ… ØªØ±Ø¬Ù…Ø© Excel Ùˆ Word Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ!",
                    "ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª **Word (.docx)** Ùˆ **Excel (.xlsx)** Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ØŒ Ø£Ùˆ Ù…Ù„ÙØ§Øª **.txt**."
                ],
                tr: [
                    "ğŸ“‚ **Desteklenen Formatlar:**\n\nâ€¢ **Belgeler:** Word (`.docx`), Excel (`.xlsx`), DÃ¼z Metin (`.txt`).\nâ€¢ **Resimler:** JPG, JPEG, PNG.\n\nNot: PDF dosyalarÄ± doÄŸrudan desteklenmez, ancak Excel ve Word mÃ¼kemmel ÅŸekilde Ã§evrilir!",
                    "BiÃ§imlendirmeyi korumak iÃ§in **Word (.docx)** ve **Excel (.xlsx)** dosyalarÄ± veya **.txt** dosyalarÄ± yÃ¼kleyebilirsiniz."
                ]
            }
        },
        languages: {
            priority: 4,
            keywords: {
                fr: ['quelles langues', 'combien de langues', 'liste des langues', 'supportes-tu', 'disponibles'],
                en: ['which languages', 'how many languages', 'list languages', 'do you support', 'available'],
                es: ['quÃ© idiomas', 'cuÃ¡ntos idiomas', 'lista de idiomas', 'soportas', 'disponibles'],
                ar: ['Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù„ØºØ§Øª', 'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª', 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ØºØ§Øª', 'ØªØ¯Ø¹Ù…', 'Ù…ØªØ§Ø­Ø©'],
                tr: ['hangi diller', 'kaÃ§ dil', 'dil listesi', 'destekliyor', 'mevcut']
            },
            responses: {
                fr: [
                    "Actuellement, je supporte parfaitement 5 langues : **FranÃ§ais, Anglais, Espagnol, Arabe et Turc**. Je peux traduire du texte, des images et des documents entre n'importe laquelle de ces langues.",
                    "Notre systÃ¨me est optimisÃ© pour 5 langues clÃ©s : FranÃ§ais ğŸ‡«ğŸ‡·, Anglais ğŸ‡¬ğŸ‡§, Espagnol ğŸ‡ªğŸ‡¸, Arabe ğŸ‡¸ğŸ‡¦ et Turc ğŸ‡¹ğŸ‡·."
                ],
                en: [
                    "Currently, I fully support 5 languages: **French, English, Spanish, Arabic, and Turkish**. I can translate text, images, and documents between any of these.",
                    "Our system is optimized for 5 key languages: French ğŸ‡«ğŸ‡·, English ğŸ‡¬ğŸ‡§, Spanish ğŸ‡ªğŸ‡¸, Arabic ğŸ‡¸ğŸ‡¦, and Turkish ğŸ‡¹ğŸ‡·."
                ],
                es: [
                    "Actualmente, soporto perfectamente 5 idiomas: **FrancÃ©s, InglÃ©s, EspaÃ±ol, Ãrabe y Turco**. Puedo traducir texto, imÃ¡genes y documentos entre cualquiera de ellos.",
                    "Nuestro sistema estÃ¡ optimizado para 5 idiomas clave: FrancÃ©s ğŸ‡«ğŸ‡·, InglÃ©s ğŸ‡¬ğŸ‡§, EspaÃ±ol ğŸ‡ªğŸ‡¸, Ãrabe ğŸ‡¸ğŸ‡¦ y Turco ğŸ‡¹ğŸ‡·."
                ],
                ar: [
                    "Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø£Ø¯Ø¹Ù… 5 Ù„ØºØ§Øª Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„: **Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ±ÙƒÙŠØ©**. ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¨ÙŠÙ† Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù„ØºØ§Øª.",
                    "Ù†Ø¸Ø§Ù…Ù†Ø§ Ù…Ø­Ø³Ù† Ù„Ù€ 5 Ù„ØºØ§Øª Ø±Ø¦ÙŠØ³ÙŠØ©: Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© ğŸ‡«ğŸ‡· ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ğŸ‡¬ğŸ‡§ ÙˆØ§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠØ© ğŸ‡ªğŸ‡¸ ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ© ğŸ‡¹ğŸ‡·."
                ],
                tr: [
                    "Åu anda 5 dili tam olarak destekliyorum: **FransÄ±zca, Ä°ngilizce, Ä°spanyolca, ArapÃ§a ve TÃ¼rkÃ§e**. Bunlar arasÄ±nda metin, resim ve belge Ã§evirebilirim.",
                    "Sistemimiz 5 temel dil iÃ§in optimize edilmiÅŸtir: FransÄ±zca ğŸ‡«ğŸ‡·, Ä°ngilizce ğŸ‡¬ğŸ‡§, Ä°spanyolca ğŸ‡ªğŸ‡¸, ArapÃ§a ğŸ‡¸ğŸ‡¦ ve TÃ¼rkÃ§e ğŸ‡¹ğŸ‡·."
                ]
            }
        },
        privacy: {
            priority: 6,
            keywords: {
                fr: ['sÃ©curitÃ©', 'privÃ©', 'confidentialitÃ©', 'stocker', 'sauvegarder', 'donnÃ©es', 'mes informations', 'serveur'],
                en: ['security', 'privacy', 'confidential', 'store', 'save', 'data', 'my info', 'server'],
                es: ['seguridad', 'privacidad', 'confidencial', 'almacenar', 'guardar', 'datos', 'mis datos', 'servidor'],
                ar: ['Ø£Ù…Ø§Ù†', 'Ø®ØµÙˆØµÙŠØ©', 'Ø³Ø±ÙŠ', 'ØªØ®Ø²ÙŠÙ†', 'Ø­ÙØ¸', 'Ø¨ÙŠØ§Ù†Ø§Øª', 'Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ', 'Ø®Ø§Ø¯Ù…'],
                tr: ['gÃ¼venlik', 'gizlilik', 'mahremiyet', 'saklama', 'kaydetme', 'veri', 'bilgilerim', 'sunucu']
            },
            responses: {
                fr: [
                    "ğŸ›¡ï¸ **Vos donnÃ©es sont en sÃ©curitÃ©.**\nNous ne stockons PAS vos textes ou documents sur nos serveurs aprÃ¨s la traduction. L'historique que vous voyez est stockÃ© uniquement localement dans votre propre navigateur.",
                    "La confidentialitÃ© est notre prioritÃ©. Vos documents Excel et images sont traitÃ©s en mÃ©moire vive et effacÃ©s immÃ©diatement aprÃ¨s la traduction."
                ],
                en: [
                    "ğŸ›¡ï¸ **Your data is safe.**\nWe do NOT store your texts or documents on our servers after translation. The history you see is stored only locally in your own browser.",
                    "Privacy is our priority. Your Excel documents and images are processed in RAM and deleted immediately after translation."
                ],
                es: [
                    "ğŸ›¡ï¸ **Tus datos estÃ¡n seguros.**\nNO almacenamos tus textos o documentos en nuestros servidores despuÃ©s de la traducciÃ³n. El historial que ves se almacena solo localmente en tu navegador.",
                    "La privacidad es nuestra prioridad. Tus documentos Excel e imÃ¡genes se procesan en la memoria RAM y se eliminan inmediatamente despuÃ©s."
                ],
                ar: [
                    "ğŸ›¡ï¸ **Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¢Ù…Ù†Ø©.**\nÙ†Ø­Ù† Ù„Ø§ Ù†Ù‚ÙˆÙ… Ø¨ØªØ®Ø²ÙŠÙ† Ù†ØµÙˆØµÙƒ Ø£Ùˆ Ù…Ø³ØªÙ†Ø¯Ø§ØªÙƒ Ø¹Ù„Ù‰ Ø®ÙˆØ§Ø¯Ù…Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø¬Ù…Ø©. Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø°ÙŠ ØªØ±Ø§Ù‡ Ù…Ø®Ø²Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙ‚Ø· ÙÙŠ Ù…ØªØµÙØ­Ùƒ Ø§Ù„Ø®Ø§Øµ.",
                    "Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù‡ÙŠ Ø£ÙˆÙ„ÙˆÙŠØªÙ†Ø§. ØªØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø³ØªÙ†Ø¯Ø§Øª Excel ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙˆØ­Ø°ÙÙ‡Ø§ ÙÙˆØ±Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø¬Ù…Ø©."
                ],
                tr: [
                    "ğŸ›¡ï¸ **Verileriniz gÃ¼vende.**\nÃ‡eviriden sonra metinlerinizi veya belgelerinizi sunucularÄ±mÄ±zda SAKLAMIYORUZ. GÃ¶rdÃ¼ÄŸÃ¼nÃ¼z geÃ§miÅŸ yalnÄ±zca kendi tarayÄ±cÄ±nÄ±zda yerel olarak saklanÄ±r.",
                    "Gizlilik Ã¶nceliÄŸimizdir. Excel belgeleriniz ve resimleriniz RAM'de iÅŸlenir ve Ã§eviriden hemen sonra silinir."
                ]
            }
        },
        cost: {
            priority: 4,
            keywords: {
                fr: ['prix', 'coÃ»t', 'payant', 'gratuit', 'abonnement', 'payer', 'tarif', 'argent'],
                en: ['price', 'cost', 'pay', 'free', 'subscription', 'payment', 'rates', 'money'],
                es: ['precio', 'costo', 'pagar', 'gratis', 'suscripciÃ³n', 'pago', 'tarifas', 'dinero'],
                ar: ['Ø³Ø¹Ø±', 'ØªÙƒÙ„ÙØ©', 'Ø¯ÙØ¹', 'Ù…Ø¬Ø§Ù†ÙŠ', 'Ø§Ø´ØªØ±Ø§Ùƒ', 'Ù…Ø§Ù„', 'Ø±Ø³ÙˆÙ…'],
                tr: ['fiyat', 'maliyet', 'Ã¶de', 'Ã¼cretsiz', 'abonelik', 'Ã¶deme', 'Ã¼cret', 'para']
            },
            responses: {
                fr: [
                    "Cette application est **100% gratuite** ! ğŸ‰\nVous pouvez traduire autant de texte, d'images et de fichiers Excel que vous le souhaitez sans aucun frais ni abonnement.",
                    "Pas de carte de crÃ©dit requise. Notre outil de traduction Java AI est entiÃ¨rement gratuit pour tous les utilisateurs."
                ],
                en: [
                    "This application is **100% free**! ğŸ‰\nYou can translate as much text, images, and Excel files as you want without any fees or subscription.",
                    "No credit card required. Our Java AI translation tool is completely free for all users."
                ],
                es: [
                    "Â¡Esta aplicaciÃ³n es **100% gratuita**! ğŸ‰\nPuedes traducir tanto texto, imÃ¡genes y archivos Excel como desees sin tarifas ni suscripciones.",
                    "No se requiere tarjeta de crÃ©dito. Nuestra herramienta es completamente gratuita."
                ],
                ar: [
                    "Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ **Ù…Ø¬Ø§Ù†ÙŠ 100Ùª**! ğŸ‰\nÙŠÙ…ÙƒÙ†Ùƒ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù‚Ø¯Ø± Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡ Ù…Ù† Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„ØµÙˆØ± ÙˆÙ…Ù„ÙØ§Øª Excel Ø¯ÙˆÙ† Ø£ÙŠ Ø±Ø³ÙˆÙ… Ø£Ùˆ Ø§Ø´ØªØ±Ø§Ùƒ.",
                    "Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†. Ø£Ø¯Ø§Ø© ØªØ±Ø¬Ù…Ø© Java AI Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù†Ø§ Ù…Ø¬Ø§Ù†ÙŠØ© ØªÙ…Ø§Ù…Ù‹Ø§ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†."
                ],
                tr: [
                    "Bu uygulama **%100 Ã¼cretsizdir**! ğŸ‰\nÄ°stediÄŸiniz kadar metin, resim ve Excel dosyasÄ±nÄ± Ã¼cret veya abonelik olmadan Ã§evirebilirsiniz.",
                    "Kredi kartÄ± gerekmez. Java AI Ã§eviri aracÄ±mÄ±z tÃ¼m kullanÄ±cÄ±lar iÃ§in tamamen Ã¼cretsizdir."
                ]
            }
        },
        limits: {
            priority: 4,
            keywords: {
                fr: ['limite', 'maximum', 'taille', 'caractÃ¨res', 'longueur', 'gros fichier', 'lourd'],
                en: ['limit', 'maximum', 'size', 'characters', 'length', 'big file', 'large'],
                es: ['lÃ­mite', 'mÃ¡ximo', 'tamaÃ±o', 'caracteres', 'longitud', 'archivo grande', 'pesado'],
                ar: ['Ø­Ø¯', 'Ø£Ù‚ØµÙ‰', 'Ø­Ø¬Ù…', 'Ø£Ø­Ø±Ù', 'Ø·ÙˆÙ„', 'Ù…Ù„Ù ÙƒØ¨ÙŠØ±', 'Ø«Ù‚ÙŠÙ„'],
                tr: ['sÄ±nÄ±r', 'maksimum', 'boyut', 'karakter', 'uzunluk', 'bÃ¼yÃ¼k dosya', 'aÄŸÄ±r']
            },
            responses: {
                fr: [
                    "**Limites actuelles :**\nâ€¢ Texte : 5000 caractÃ¨res par traduction.\nâ€¢ Fichiers (Excel/Word) : Jusqu'Ã  10 Mo environ.\nâ€¢ Images : Formats standards (JPG, PNG).\n\nSi vous avez un texte plus long, essayez de le traduire par morceaux !",
                    "Pour garantir la rapiditÃ©, nous limitons le texte Ã  5000 caractÃ¨res. Pour les fichiers Excel volumineux, le traitement peut prendre quelques secondes de plus."
                ],
                en: [
                    "**Current limits:**\nâ€¢ Text: 5000 characters per translation.\nâ€¢ Files (Excel/Word): Up to about 10 MB.\nâ€¢ Images: Standard formats (JPG, PNG).\n\nIf you have longer text, try translating it in chunks!",
                    "To ensure speed, we limit text to 5000 characters. For large Excel files, processing might take a few extra seconds."
                ],
                es: [
                    "**LÃ­mites actuales:**\nâ€¢ Texto: 5000 caracteres por traducciÃ³n.\nâ€¢ Archivos (Excel/Word): Hasta unos 10 MB.\nâ€¢ ImÃ¡genes: Formatos estÃ¡ndar (JPG, PNG).\n\nÂ¡Si tienes un texto mÃ¡s largo, intenta traducirlo por partes!",
                    "Para garantizar la velocidad, limitamos el texto a 5000 caracteres."
                ],
                ar: [
                    "**Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:**\nâ€¢ Ø§Ù„Ù†Øµ: 5000 Ø­Ø±Ù Ù„ÙƒÙ„ ØªØ±Ø¬Ù…Ø©.\nâ€¢ Ø§Ù„Ù…Ù„ÙØ§Øª (Excel/Word): Ù…Ø§ ÙŠØµÙ„ Ø¥Ù„Ù‰ Ø­ÙˆØ§Ù„ÙŠ 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª.\nâ€¢ Ø§Ù„ØµÙˆØ±: Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© (JPG ØŒ PNG).\n\nØ¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ù†Øµ Ø£Ø·ÙˆÙ„ ØŒ ÙØ­Ø§ÙˆÙ„ ØªØ±Ø¬Ù…ØªÙ‡ Ø¹Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡!",
                    "Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø© ØŒ Ù†Ø­Ø¯Ø¯ Ø§Ù„Ù†Øµ Ø¨Ù€ 5000 Ø­Ø±Ù. Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù…Ù„ÙØ§Øª Excel Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ØŒ Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù Ø¥Ø¶Ø§ÙÙŠØ©."
                ],
                tr: [
                    "**Mevcut sÄ±nÄ±rlar:**\nâ€¢ Metin: Ã‡eviri baÅŸÄ±na 5000 karakter.\nâ€¢ Dosyalar (Excel/Word): YaklaÅŸÄ±k 10 MB'a kadar.\nâ€¢ Resimler: Standart formatlar (JPG, PNG).\n\nDaha uzun metniniz varsa, parÃ§alar halinde Ã§evirmeyi deneyin!",
                    "HÄ±zÄ± garanti etmek iÃ§in metni 5000 karakterle sÄ±nÄ±rlandÄ±rÄ±yoruz."
                ]
            }
        },
        default: {
            priority: 0,
            responses: {
                fr: [
                    "Je suis spÃ©cialisÃ© dans l'aide Ã  la traduction. Pourriez-vous reformuler votre question en rapport avec les langues, la traduction de texte, d'images ou de documents ?",
                    "En tant qu'assistant de traduction, je peux vous aider avec :\nâ€¢ La traduction de texte\nâ€¢ L'extraction de texte d'images\nâ€¢ La traduction de documents\nâ€¢ L'utilisation des fonctionnalitÃ©s audio\n\nQue souhaitez-vous savoir ?",
                    "Je comprends votre question, mais je suis optimisÃ© pour les sujets de traduction. Essayez de me demander quelque chose sur les langues, la traduction ou les fonctionnalitÃ©s de notre application !"
                ],
                en: [
                    "I specialize in translation assistance. Could you rephrase your question in relation to languages, text translation, images, or documents?",
                    "As a translation assistant, I can help you with:\nâ€¢ Text translation\nâ€¢ Text extraction from images\nâ€¢ Document translation\nâ€¢ Using audio features\n\nWhat would you like to know?",
                    "I understand your question, but I'm optimized for translation topics. Try asking me something about languages, translation, or our app's features!"
                ],
                es: [
                    "Me especializo en asistencia de traducciÃ³n. Â¿PodrÃ­a reformular su pregunta en relaciÃ³n con idiomas, traducciÃ³n de texto, imÃ¡genes o documentos?",
                    "Como asistente de traducciÃ³n, puedo ayudarte con:\nâ€¢ TraducciÃ³n de texto\nâ€¢ ExtracciÃ³n de texto de imÃ¡genes\nâ€¢ TraducciÃ³n de documentos\nâ€¢ Uso de funciones de audio\n\nÂ¿QuÃ© te gustarÃ­a saber?",
                    "Entiendo tu pregunta, pero estoy optimizado para temas de traducciÃ³n. Â¡Intenta preguntarme algo sobre idiomas, traducciÃ³n o las caracterÃ­sticas de nuestra aplicaciÃ³n!"
                ],
                ar: [
                    "Ø£ØªØ®ØµØµ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø©. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ© Ø³Ø¤Ø§Ù„Ùƒ ÙÙŠÙ…Ø§ ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù„ØºØ§Øª Ø£Ùˆ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†ØµÙˆØµ Ø£Ùˆ Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§ØªØŸ",
                    "ÙƒÙ…Ø³Ø§Ø¹Ø¯ ØªØ±Ø¬Ù…Ø©ØŒ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:\nâ€¢ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†Øµ\nâ€¢ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±\nâ€¢ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª\nâ€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙŠØ²Ø§Øª Ø§Ù„ØµÙˆØª\n\nÙ…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ØŸ",
                    "Ø£ÙÙ‡Ù… Ø³Ø¤Ø§Ù„ÙƒØŒ Ù„ÙƒÙ†Ù†ÙŠ Ù…Ø­Ø³Ù† Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„ØªØ±Ø¬Ù…Ø©. Ø­Ø§ÙˆÙ„ Ø£Ù† ØªØ³Ø£Ù„Ù†ÙŠ Ø´ÙŠØ¦Ù‹Ø§ Ø¹Ù† Ø§Ù„Ù„ØºØ§Øª Ø£Ùˆ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø£Ùˆ Ù…ÙŠØ²Ø§Øª ØªØ·Ø¨ÙŠÙ‚Ù†Ø§!"
                ],
                tr: [
                    "Ã‡eviri yardÄ±mÄ±nda uzmanlaÅŸtÄ±m. Sorunuzu diller, metin Ã§evirisi, gÃ¶rÃ¼ntÃ¼ler veya belgelerle ilgili olarak yeniden ifade edebilir misiniz?",
                    "Bir Ã§eviri asistanÄ± olarak size ÅŸu konularda yardÄ±mcÄ± olabilirim:\nâ€¢ Metin Ã§evirisi\nâ€¢ GÃ¶rÃ¼ntÃ¼lerden metin Ã§Ä±karma\nâ€¢ Belge Ã§evirisi\nâ€¢ Ses Ã¶zelliklerini kullanma\n\nNe bilmek istiyorsunuz?",
                    "Sorunuzu anlÄ±yorum, ancak Ã§eviri konularÄ± iÃ§in optimize edildim. Bana diller, Ã§eviri veya uygulamamÄ±zÄ±n Ã¶zellikleri hakkÄ±nda bir ÅŸeyler sorun!"
                ]
            }
        }
    };;

    function getIntelligentResponse(message, lang) {
        const lowerMessage = message.toLowerCase();
        
        const foundCategories = [];
        
        for (const category in knowledgeBase) {
            if (category === 'default') continue;
            
            const keywords = knowledgeBase[category].keywords[lang];
            if (keywords) {
                for (const keyword of keywords) {
                    const regex = new RegExp(`\\b${keyword.replace(/\\b/g, '')}\\b`, 'i');
                    if (regex.test(lowerMessage)) {
                        foundCategories.push({
                            category: category,
                            priority: knowledgeBase[category].priority,
                            keyword: keyword
                        });
                        break;
                    }
                }
            }
        }
        
        foundCategories.sort((a, b) => b.priority - a.priority);
        
        if (foundCategories.length > 0) {
            const bestCategory = foundCategories[0].category;
            const responses = knowledgeBase[bestCategory].responses[lang];
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        const defaultResponses = knowledgeBase.default.responses[lang];
        return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
    }

    function sendChatMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message) return;
        
        addMessageToChat(message, 'user');
        input.value = '';
        
        setTimeout(() => {
            const response = getIntelligentResponse(message, currentChatLanguage);
            addMessageToChat(response, 'bot');
            
            chatHistory.push({ role: "user", content: message });
            chatHistory.push({ role: "assistant", content: response });
            
            if (chatHistory.length > 20) {
                chatHistory = chatHistory.slice(-20);
            }
        }, 500);
    }

    function addMessageToChat(text, sender) {
        const chatMessagesContainer = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        const id = 'msg-' + Date.now();
        messageDiv.id = id;
        messageDiv.className = `message ${sender}`;
        
        // --- AJOUT : Appliquer la classe RTL si la langue actuelle est l'arabe ---
        if (currentChatLanguage === 'ar') {
            messageDiv.classList.add('rtl-arabic');
        }
        // -----------------------------------------------------------------------
        
        const formattedText = text.replace(/\n/g, '<br>');
        messageDiv.innerHTML = formattedText;
        
        chatMessagesContainer.appendChild(messageDiv);
        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        return id;
    }

    function clearChat() {
        if (confirm("Voulez-vous vraiment effacer la conversation ?")) {
            document.getElementById('chatMessages').innerHTML = '';
            chatHistory = [];
            addWelcomeMessage();
        }
    }

    document.getElementById('sourceLang').addEventListener('change', updateLangLabels);
    document.getElementById('targetLang').addEventListener('change', updateLangLabels);
    
    function updateLangLabels() {
        const sourceSelect = document.getElementById('sourceLang');
        const targetSelect = document.getElementById('targetLang');
        const sourceLang = sourceSelect.options[sourceSelect.selectedIndex].text;
        const targetLang = targetSelect.options[targetSelect.selectedIndex].text;
        
        document.getElementById('sourceLangLabel').textContent = sourceLang === 'DÃ©tecter la langue' ? 'DÃ©tection automatique' : sourceLang;
        document.getElementById('targetLangLabel').textContent = targetLang;

        updateDetectedLangDisplay();
        applyRTLStyles();
    }
    
    function updateDetectedLangDisplay() {
        const detectedLabel = document.getElementById('detectedLangLabel');
        const sourceLang = document.getElementById('sourceLang').value;
        
        if (sourceLang === 'auto' && globalDetectedLang && detectedLangNames[globalDetectedLang]) {
            detectedLabel.textContent = `(dÃ©tectÃ©: ${detectedLangNames[globalDetectedLang]})`;
        } else {
            detectedLabel.textContent = '';
        }
    }
    
    updateLangLabels();
    
    document.getElementById('swapLangs').addEventListener('click', function() {
        const sourceLang = document.getElementById('sourceLang');
        const targetLang = document.getElementById('targetLang');
        const sourceValue = sourceLang.value;
        const targetValue = targetLang.value;
        
        if (sourceValue === 'auto') {
            alert("Impossible d'Ã©changer les langues lorsque 'DÃ©tecter la langue' est sÃ©lectionnÃ©");
            return;
        }
        
        sourceLang.value = targetValue;
        targetLang.value = sourceValue;
        
        const inputText = document.getElementById('inputText').value;
        const outputText = document.getElementById('outputText').value;
        
        if (inputText.trim() && outputText.trim()) {
            document.getElementById('inputText').value = outputText;
            document.getElementById('outputText').value = inputText;
        }
        
        updateLangLabels();
        translateText();
    });
    
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            const tabId = this.getAttribute('data-tab');
            document.getElementById('textTab').style.display = tabId === 'text' ? 'block' : 'none';
            document.getElementById('chatbotTab').style.display = tabId === 'chatbot' ? 'block' : 'none';
            
            if (tabId !== 'text') {
                clearImage();
            }
            
            if (tabId === 'chatbot') {
                setTimeout(() => {
                    document.getElementById('chatInput').focus();
                    if (document.getElementById('chatMessages').children.length === 0) {
                        addWelcomeMessage();
                    }
                }, 100);
            }
        });
    });
    
    document.getElementById('historyBtn').addEventListener('click', toggleHistory);
    
    function toggleHistory() {
        const sidebar = document.getElementById('historySidebar');
        sidebar.classList.toggle('active');
        
        if (sidebar.classList.contains('active')) {
            loadHistory();
        }
    }
    
    document.querySelectorAll('.history-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.history-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            currentHistoryTab = this.getAttribute('data-history-tab');
            loadHistory();
        });
    });
    
    function loadHistory() {
        const historyList = document.getElementById('historyList');
        historyList.innerHTML = '';
        
        const filteredHistory = history.filter(item => {
            if (currentHistoryTab === 'all') return true;
            return item.type === currentHistoryTab;
        });
        
        if (filteredHistory.length === 0) {
            historyList.innerHTML = `
                <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                    <i class="fas fa-history fa-2x" style="margin-bottom: 16px;"></i>
                    <p>Aucun Ã©lÃ©ment dans l'historique</p>
                </div>
            `;
            return;
        }
        
        filteredHistory.forEach((item, index) => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.onclick = () => loadHistoryItem(item);
            
            let content = '';
            if (item.type === 'text') {
                content = `
                    <div class="history-item-header">
                        <span class="history-type">Texte</span>
                        <span class="history-date">${formatDate(item.timestamp)}</span>
                    </div>
                    <div class="history-text" title="${item.data.inputText}">${item.data.inputText.substring(0, 100)}${item.data.inputText.length > 100 ? '...' : ''}</div>
                    <div class="history-langs">${item.sourceLang} â†’ ${item.targetLang}</div>
                `;
            } else if (item.type === 'images') {
                content = `
                    <div class="history-item-header">
                        <span class="history-type">Image</span>
                        <span class="history-date">${formatDate(item.timestamp)}</span>
                    </div>
                    <div class="history-file-name">${item.data.fileName}</div>
                    <div class="history-langs">${item.sourceLang} â†’ ${item.targetLang}</div>
                `;
            } else if (item.type === 'documents') {
                content = `
                    <div class="history-item-header">
                        <span class="history-type">Document</span>
                        <span class="history-date">${formatDate(item.timestamp)}</span>
                    </div>
                    <div class="history-file-name">${item.data.fileName}</div>
                    <div class="history-langs">${item.sourceLang} â†’ ${item.targetLang}</div>
                `;
            }
            
            historyItem.innerHTML = content;
            historyList.appendChild(historyItem);
        });
    }
    
    function formatDate(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        
        if (diffMins < 60) {
            return `Il y a ${diffMins} min`;
        } else if (diffHours < 24) {
            return `Il y a ${diffHours} h`;
        } else if (diffDays < 7) {
            return `Il y a ${diffDays} j`;
        } else {
            return date.toLocaleDateString('fr-FR');
        }
    }
    
    function loadHistoryItem(item) {
        if (item.type === 'text') {
            document.getElementById('inputText').value = item.data.inputText;
            document.getElementById('outputText').value = item.data.outputText;
            document.getElementById('sourceLang').value = item.sourceLang;
            document.getElementById('targetLang').value = item.targetLang;
            if (item.sourceLang && item.sourceLang !== 'auto') {
                globalDetectedLang = item.sourceLang;
            }
            updateLangLabels();
            updateCharCount();
            clearImage();
        } else if (item.type === 'images') {
            document.getElementById('inputText').value = item.data.inputText || '';
            document.getElementById('outputText').value = item.data.outputText || '';
            document.getElementById('sourceLang').value = item.sourceLang;
            document.getElementById('targetLang').value = item.targetLang;
            if (item.sourceLang && item.sourceLang !== 'auto') {
                globalDetectedLang = item.sourceLang;
            }
            updateLangLabels();
            updateCharCount();
            clearImage();
        } else if (item.type === 'documents') {
            document.getElementById('sourceLang').value = item.sourceLang;
            document.getElementById('targetLang').value = item.targetLang;
            if (item.sourceLang && item.sourceLang !== 'auto') {
                globalDetectedLang = item.sourceLang;
            }
            updateLangLabels();
            alert("Le document ne peut pas Ãªtre rechargÃ©, mais les paramÃ¨tres de langue ont Ã©tÃ© mis Ã  jour.");
            clearImage();
        }
        toggleHistory();
    }
    
    function clearHistory() {
        if (confirm("Voulez-vous vraiment effacer tout l'historique ?")) {
            history = [];
            localStorage.setItem('translationHistory', JSON.stringify(history));
            loadHistory();
        }
    }
    
    function addToHistory(type, sourceLang, targetLang, data) {
        const historyItem = {
            id: Date.now(),
            type: type,
            sourceLang: sourceLang,
            targetLang: targetLang,
            timestamp: Date.now(),
            data: data
        };
        
        history.unshift(historyItem);
        if (history.length > 50) {
            history = history.slice(0, 50);
        }
        
        localStorage.setItem('translationHistory', JSON.stringify(history));
    }
    
    document.getElementById('inputText').addEventListener('input', updateCharCount);
    
    function updateCharCount() {
        const text = document.getElementById('inputText').value;
        const charCount = text.length;
        document.getElementById('charCount').textContent = `${charCount}/5000`;
        
        if (charCount > 5000) {
            document.getElementById('inputText').style.color = 'red';
        } else {
            document.getElementById('inputText').style.color = '';
        }
    }
    
    let timeout = null;
    const inputText = document.getElementById('inputText');
    inputText.addEventListener('keyup', () => {
        clearTimeout(timeout);
        timeout = setTimeout(() => { translateText(); }, 800);
    });

async function translateText() {
    const text = document.getElementById('inputText').value;
    const source = document.getElementById('sourceLang').value;
    const target = document.getElementById('targetLang').value;
    
    if(text.trim() === "") return;

    try {
        // Envoyer le texte avec les sauts de ligne prÃ©servÃ©s
        const response = await fetch('/api/translate-text', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ 
                text: text, 
                sourceLang: source, 
                targetLang: target,
                preserveFormatting: true // Ajouter ce paramÃ¨tre si l'API le supporte
            })
        });
        
        const data = await response.json();
        
        // Remplacer les marqueurs de paragraphe par des sauts de ligne si nÃ©cessaire
        let translatedText = data.translatedText;
        
        // Si l'API ne prÃ©serve pas automatiquement la mise en forme,
        // nous traitons les retours Ã  la ligne
        if (translatedText) {
            // Option 1: Si l'API renvoie des marqueurs spÃ©cifiques
            translatedText = translatedText.replace(/\\n/g, '\n');
            translatedText = translatedText.replace(/<br\/?>/g, '\n');
            translatedText = translatedText.replace(/\\r\\n/g, '\n');
            
            // Option 2: Conserver les sauts de ligne originaux en traduisant par paragraphe
            // (dÃ©commentez cette section si l'API ne conserve pas la mise en forme)
            
            if (text.includes('\n')) {
                const paragraphs = text.split('\n');
                const translatedParagraphs = [];
                
                for (const paragraph of paragraphs) {
                    if (paragraph.trim() === '') {
                        translatedParagraphs.push('');
                        continue;
                    }
                    
                    const paraResponse = await fetch('/api/translate-text', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ 
                            text: paragraph, 
                            sourceLang: source, 
                            targetLang: target 
                        })
                    });
                    const paraData = await paraResponse.json();
                    translatedParagraphs.push(paraData.translatedText);
                }
                
                translatedText = translatedParagraphs.join('\n');
            }
            
        }
        
        document.getElementById('outputText').value = translatedText;

        // Traductions forcÃ©es pour les mots spÃ©cifiques
        if (text.trim().toLowerCase() === 'bonjour' && target !== 'fr') {
            const forcedMap = { en: 'hello', es: 'hola', ar: 'Ù…Ø±Ø­Ø¨Ø§', tr: 'merhaba' };
            document.getElementById('outputText').value = forcedMap[target] || data.translatedText;
        }
        if (text.trim().toLowerCase() === 'gracias' && target !== 'es') {
            const forcedMap = { fr: 'merci', en: 'thank you', ar: 'Ø´ÙƒØ±Ø§', tr: 'teÅŸekkÃ¼rler' };
            document.getElementById('outputText').value = forcedMap[target] || data.translatedText;
        }
        
        document.getElementById('translatedCharCount').textContent = 
            `${document.getElementById('outputText').value.length} caractÃ¨res`;

        const detectedCode = data.detectedSourceLang || data.detectedSourceText;
        
        if (detectedCode) {
            globalDetectedLang = detectedCode;
            if (typeof updateDetectedLangDisplay === 'function') {
                updateDetectedLangDisplay();
            }
        }

        // Appliquer les styles RTL aprÃ¨s la traduction
        applyRTLStyles();

        if (text.trim() && document.getElementById('outputText').value.trim()) {
            addToHistory('text', source === 'auto' ? globalDetectedLang : source, target, {
                inputText: text,
                outputText: document.getElementById('outputText').value
            });
        }
    } catch (e) {
        console.error(e);
    }
    // Ajouter Ã  la fin de translateText()
setTimeout(saveCompletePageState, 300);
}

    
    function startDictation() {
        if (window.hasOwnProperty('webkitSpeechRecognition')) {
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            const selectedLang = document.getElementById('sourceLang').value;
            
            const speechLangMap = {
                'fr': 'fr-FR',
                'en': 'en-US',
                'es': 'es-ES',
                'ar': 'ar-SA',
                'tr': 'tr-TR',
                'auto': 'fr-FR'
            };
            
            if (selectedLang === 'auto') {
                recognition.lang = globalDetectedLang ? 
                    speechLangMap[globalDetectedLang] || 'fr-FR' : 'fr-FR';
            } else {
                recognition.lang = speechLangMap[selectedLang] || 'fr-FR';
            }
            
            recognition.start();
            recognition.onresult = function(e) {
                document.getElementById('inputText').value = e.results[0][0].transcript;
                translateText();
                updateCharCount();
            };
            
            recognition.onerror = function(e) {
                console.error("Erreur reconnaissance vocale:", e.error);
            };
        } else {
            alert("Pas de micro supportÃ©");
        }
    }
    
    let currentAudio = new Audio();
    let isPlaying = false;
    
    function readText(elementId) {
    if (isPlaying) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        isPlaying = false;
        return;
    }
    
    const text = document.getElementById(elementId).value;
    
    if (text.trim().toLowerCase() === 'bonjour') { playChunks(['bonjour'], 'fr', 0); return; }
    if (text.trim().toLowerCase() === 'gracias') { playChunks(['gracias'], 'es', 0); return; }

    if (!text || text.trim() === "") return;

    let lang;
    if (elementId === 'inputText') {
        const selectedLang = document.getElementById('sourceLang').value;
        
        if (selectedLang === 'auto') {
            lang = globalDetectedLang ? globalDetectedLang : 'fr';
        } else {
            lang = selectedLang;
        }
    } else {
        lang = document.getElementById('targetLang').value;
    }

    let cleanLang = String(lang).toLowerCase().substring(0, 2);

    const ttsLangMap = {
        'fr': 'fr',
        'en': 'en',
        'es': 'es',
        'ar': 'ar',
        'tr': 'tr'
    };
    
    const ttsLang = ttsLangMap[cleanLang] || 'en';
    
    const chunks = splitTextIntoChunks(text, 180);
    playChunks(chunks, ttsLang, 0);
}

    function playChunks(chunks, lang, index) {
        if (index >= chunks.length) { isPlaying = false; return; }
        isPlaying = true;

        const encodedText = encodeURIComponent(chunks[index]);
        const url = `https://translate.google.com/translate_tts?ie=UTF-8&client=gtx&tl=${lang}&q=${encodedText}`;

        currentAudio.src = url;
        currentAudio.playbackRate = 1;
        currentAudio.play().catch(e => { console.error("Erreur audio", e); isPlaying = false; });
        currentAudio.onended = function() { playChunks(chunks, lang, index + 1); };
    }

    function splitTextIntoChunks(text, maxLength) {
        const sentences = text.match(/[^.?!]+[.?!]+|[^.?!]+$/g) || [text];
        const chunks = [];
        let currentChunk = "";
        sentences.forEach(sentence => {
            if (sentence.length > maxLength) {
                const words = sentence.split(' ');
                words.forEach(word => {
                    if ((currentChunk + word).length < maxLength) currentChunk += word + " ";
                    else { chunks.push(currentChunk.trim()); currentChunk = word + " "; }
                });
            } else {
                if ((currentChunk + sentence).length < maxLength) currentChunk += sentence + " ";
                else { chunks.push(currentChunk.trim()); currentChunk = sentence + " "; }
            }
        });
        if (currentChunk.trim().length > 0) chunks.push(currentChunk.trim());
        return chunks;
    }

    async function uploadFile() {
        const fileInput = document.getElementById('fileUpload');
        if(fileInput.files.length === 0) return;
        
        const formData = new FormData();
        formData.append("file", fileInput.files[0]);
        formData.append("sourceLang", document.getElementById('sourceLang').value);
        formData.append("targetLang", document.getElementById('targetLang').value);

        const response = await fetch('/api/translate-file', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            const header = response.headers.get('Content-Disposition');
            let filename = 'traduction.txt';
            if (header && header.indexOf('filename=') !== -1) {
                filename = header.split('filename=')[1].replace(/"/g, '');
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.getElementById('downloadLink');
            a.href = url;
            a.download = filename;
            a.click();
            
            addToHistory('documents', 
                document.getElementById('sourceLang').value, 
                document.getElementById('targetLang').value, 
                { fileName: fileInput.files[0].name }
            );
            
            alert("Fichier traduit tÃ©lÃ©chargÃ© !");
        } else {
            alert("Erreur lors de la traduction.");
        }

        // --- AJOUT IMPORTANT ICI : RÃ©initialiser l'input pour permettre un nouvel envoi ---
        fileInput.value = ''
    }

    async function uploadImage() {
        const fileInput = document.getElementById('imgUpload');
        if(fileInput.files.length === 0) return;
        
        const imageContainer = document.getElementById('imageContainer');
        const uploadedImage = document.getElementById('uploadedImage');
        const noImageText = document.getElementById('noImageText');
        const imageText = document.getElementById('imageText');
        const inputTextarea = document.getElementById('inputText');
        
        const imageUrl = URL.createObjectURL(fileInput.files[0]);
        uploadedImage.src = imageUrl;
        
        noImageText.style.display = 'none';
        uploadedImage.style.display = 'block';
        
        imageContainer.classList.add('active');
        inputTextarea.style.display = 'none';
        
        imageText.style.display = 'none'; 
        
        const formData = new FormData();
        formData.append("image", fileInput.files[0]);
        formData.append("sourceLang", document.getElementById('sourceLang').value);
        formData.append("targetLang", document.getElementById('targetLang').value);
        
        const response = await fetch('/api/translate-image', { method: 'POST', body: formData });
        const data = await response.json();

        inputTextarea.value = data.detectedSourceText || "";
        document.getElementById('outputText').value = data.translatedText || "";
        updateCharCount();

        if (data.detectedSourceLang) {
            globalDetectedLang = data.detectedSourceLang;
            updateDetectedLangDisplay();
        }
        
        // Appliquer les styles RTL pour l'image
        applyRTLStyles();
        
        if (data.detectedSourceText && data.translatedText) {
            addToHistory('images', 
                data.detectedSourceLang || document.getElementById('sourceLang').value, 
                document.getElementById('targetLang').value, 
                { 
                    fileName: fileInput.files[0].name,
                    inputText: data.detectedSourceText,
                    outputText: data.translatedText
                }
            );
        }
        // AprÃ¨s la traduction dans uploadImage()
setTimeout(saveCompletePageState, 300);
    }

    function copyToClipboard() {
        const output = document.getElementById('outputText');
        output.select();
        document.execCommand('copy');
        
        const copyBtn = document.querySelector('[onclick="copyToClipboard()"]');
        const originalIcon = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check"></i>';
        copyBtn.style.color = 'green';
        
        setTimeout(() => {
            copyBtn.innerHTML = originalIcon;
            copyBtn.style.color = '';
        }, 1000);
    }
    
    updateCharCount();
    
    document.addEventListener('DOMContentLoaded', function() {
        updateChatbotLanguage();
        addWelcomeMessage();
        // Appliquer les styles RTL au chargement initial
        applyRTLStyles();
    });

    
// Fonction pour sauvegarder l'Ã©tat cÃ´tÃ© serveur
async function saveTranslationStateToServer() {
    const sourceLang = document.querySelector('#source-lang');
    const targetLang = document.querySelector('#target-lang');
    const sourceText = document.querySelector('#source-text');
    const targetText = document.querySelector('#target-text');
    
    if (sourceLang && targetLang && sourceText && targetText) {
        const state = {
            sourceLang: sourceLang.value,
            targetLang: targetLang.value,
            sourceText: sourceText.value,
            targetText: targetText.value
        };
        
        try {
            await fetch('/api/save-state', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(state)
            });
        } catch (error) {
            console.error('Erreur sauvegarde Ã©tat:', error);
        }
    }
}

// Fonction pour rÃ©cupÃ©rer l'Ã©tat cÃ´tÃ© serveur
async function getTranslationStateFromServer() {
    try {
        const response = await fetch('/api/get-state');
        const state = await response.json();
        
        const sourceLang = document.querySelector('#source-lang');
        const targetLang = document.querySelector('#target-lang');
        const sourceText = document.querySelector('#source-text');
        const targetText = document.querySelector('#target-text');
        
        if (sourceLang && targetLang && sourceText && targetText) {
            sourceLang.value = state.sourceLang || 'en';
            targetLang.value = state.targetLang || 'fr';
            sourceText.value = state.sourceText || '';
            targetText.value = state.targetText || '';
            
            updateCharCount(sourceText, 'source-count');
            updateCharCount(targetText, 'target-count');
        }
    } catch (error) {
        console.error('Erreur rÃ©cupÃ©ration Ã©tat:', error);
    }
}

// Modifiez la gestion des onglets pour utiliser les fonctions serveur
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            if (this.getAttribute('data-tab') === 'chatbot') {
                saveTranslationStateToServer(); // Sauvegarde serveur
                saveTranslationState(); // Sauvegarde local (optionnel)
            } else if (this.getAttribute('data-tab') === 'text') {
                getTranslationStateFromServer(); // RÃ©cupÃ©ration serveur
            }
        });
    });
});
// Variables pour stocker l'Ã©tat COMPLET de la page
let pageState = {
    // Langues
    sourceLang: 'en',
    targetLang: 'fr',
    
    // Contenu des textareas
    inputText: '',
    outputText: '',
    
    // Dimensions des zones
    inputHeight: null,
    outputHeight: null,
    inputMinHeight: null,
    outputMinHeight: null,
    
    // Position du scroll
    inputScrollTop: 0,
    outputScrollTop: 0,
    
    // Ã‰tat de l'image (si active)
    imageActive: false,
    imageUrl: null,
    imageText: '',
    
    // Langue dÃ©tectÃ©e
    detectedLang: null,
    
    // Historique des changements pour rejouer
    actions: []
};

// Fonction pour sauvegarder TOUT l'Ã©tat
function saveCompletePageState() {
    const inputTextarea = document.getElementById('inputText');
    const outputTextarea = document.getElementById('outputText');
    const sourceLangSelect = document.getElementById('sourceLang');
    const targetLangSelect = document.getElementById('targetLang');
    const imageContainer = document.getElementById('imageContainer');
    const uploadedImage = document.getElementById('uploadedImage');
    
    if (inputTextarea && outputTextarea && sourceLangSelect && targetLangSelect) {
        pageState = {
            // Langues
            sourceLang: sourceLangSelect.value,
            targetLang: targetLangSelect.value,
            
            // Textes
            inputText: inputTextarea.value,
            outputText: outputTextarea.value,
            
            // Dimensions
            inputHeight: inputTextarea.style.height || getComputedStyle(inputTextarea).height,
            outputHeight: outputTextarea.style.height || getComputedStyle(outputTextarea).height,
            inputMinHeight: inputTextarea.style.minHeight,
            outputMinHeight: outputTextarea.style.minHeight,
            
            // Position du scroll
            inputScrollTop: inputTextarea.scrollTop,
            outputScrollTop: outputTextarea.scrollTop,
            
            // Ã‰tat de l'image
            imageActive: imageContainer.classList.contains('active'),
            imageUrl: uploadedImage.src || null,
            imageText: document.getElementById('imageText').textContent || '',
            
            // Langue dÃ©tectÃ©e
            detectedLang: globalDetectedLang,
            
            // Compteurs
            charCount: document.getElementById('charCount').textContent,
            translatedCharCount: document.getElementById('translatedCharCount').textContent,
            
            // Timestamp
            timestamp: Date.now()
        };
        
        // Sauvegarder dans localStorage
        localStorage.setItem('linganora_complete_state', JSON.stringify(pageState));
        
        // Sauvegarder aussi dans sessionStorage pour navigation immÃ©diate
        sessionStorage.setItem('linganora_session_state', JSON.stringify(pageState));
    }
}

// Fonction pour restaurer TOUT l'Ã©tat
function restoreCompletePageState() {
    try {
        // Essayer d'abord sessionStorage (navigation rÃ©cente)
        let savedState = sessionStorage.getItem('linganora_session_state');
        if (!savedState) {
            // Sinon utiliser localStorage (persistant)
            savedState = localStorage.getItem('linganora_complete_state');
        }
        
        if (savedState) {
            const state = JSON.parse(savedState);
            
            const inputTextarea = document.getElementById('inputText');
            const outputTextarea = document.getElementById('outputText');
            const sourceLangSelect = document.getElementById('sourceLang');
            const targetLangSelect = document.getElementById('targetLang');
            const imageContainer = document.getElementById('imageContainer');
            const uploadedImage = document.getElementById('uploadedImage');
            const noImageText = document.getElementById('noImageText');
            const imageText = document.getElementById('imageText');
            
            // Restaurer les langues
            if (sourceLangSelect) sourceLangSelect.value = state.sourceLang || 'en';
            if (targetLangSelect) targetLangSelect.value = state.targetLang || 'fr';
            
            // Restaurer les textes
            if (inputTextarea) inputTextarea.value = state.inputText || '';
            if (outputTextarea) outputTextarea.value = state.outputText || '';
            
            // Restaurer l'Ã©tat de l'image
            if (state.imageActive && state.imageUrl) {
                if (imageContainer && uploadedImage) {
                    uploadedImage.src = state.imageUrl;
                    uploadedImage.style.display = 'block';
                    if (noImageText) noImageText.style.display = 'none';
                    imageContainer.classList.add('active');
                    inputTextarea.style.display = 'none';
                    if (imageText && state.imageText) {
                        imageText.textContent = state.imageText;
                    }
                }
            }
            
            // Restaurer les dimensions
            if (state.inputHeight && inputTextarea) {
                inputTextarea.style.height = state.inputHeight;
                if (state.inputMinHeight) inputTextarea.style.minHeight = state.inputMinHeight;
            }
            
            if (state.outputHeight && outputTextarea) {
                outputTextarea.style.height = state.outputHeight;
                if (state.outputMinHeight) outputTextarea.style.minHeight = state.outputMinHeight;
            }
            
            // Restaurer la langue dÃ©tectÃ©e
            if (state.detectedLang) {
                globalDetectedLang = state.detectedLang;
            }
            
            // Mettre Ã  jour les labels et compteurs
            setTimeout(() => {
                if (typeof updateLangLabels === 'function') updateLangLabels();
                if (typeof updateCharCount === 'function') updateCharCount();
                if (typeof updateDetectedLangDisplay === 'function') updateDetectedLangDisplay();
                if (typeof applyRTLStyles === 'function') applyRTLStyles();
                
                // Restaurer les compteurs
                if (state.charCount && document.getElementById('charCount')) {
                    document.getElementById('charCount').textContent = state.charCount;
                }
                if (state.translatedCharCount && document.getElementById('translatedCharCount')) {
                    document.getElementById('translatedCharCount').textContent = state.translatedCharCount;
                }
                
                // Restaurer la position du scroll (aprÃ¨s un lÃ©ger dÃ©lai)
                setTimeout(() => {
                    if (inputTextarea && state.inputScrollTop) {
                        inputTextarea.scrollTop = state.inputScrollTop;
                    }
                    if (outputTextarea && state.outputScrollTop) {
                        outputTextarea.scrollTop = state.outputScrollTop;
                    }
                }, 100);
                
            }, 50);
        }
    } catch (error) {
        console.error('Erreur lors de la restauration de l\'Ã©tat:', error);
    }
}

// Observer tous les changements sur la page
function setupStateObserver() {
    // Observer les textareas
    const inputTextarea = document.getElementById('inputText');
    const outputTextarea = document.getElementById('outputText');
    
    if (inputTextarea) {
        // Sauvegarder Ã  chaque input
        inputTextarea.addEventListener('input', () => {
            setTimeout(saveCompletePageState, 100);
        });
        
        // Sauvegarder le scroll
        inputTextarea.addEventListener('scroll', () => {
            setTimeout(saveCompletePageState, 300);
        });
        
        // Sauvegarder le redimensionnement
        inputTextarea.addEventListener('mouseup', () => {
            setTimeout(saveCompletePageState, 200);
        });
    }
    
    if (outputTextarea) {
        outputTextarea.addEventListener('scroll', () => {
            setTimeout(saveCompletePageState, 300);
        });
        
        outputTextarea.addEventListener('mouseup', () => {
            setTimeout(saveCompletePageState, 200);
        });
    }
    
    // Observer les sÃ©lecteurs de langue
    const sourceLangSelect = document.getElementById('sourceLang');
    const targetLangSelect = document.getElementById('targetLang');
    
    if (sourceLangSelect) {
        sourceLangSelect.addEventListener('change', () => {
            setTimeout(saveCompletePageState, 100);
        });
    }
    
    if (targetLangSelect) {
        targetLangSelect.addEventListener('change', () => {
            setTimeout(saveCompletePageState, 100);
        });
    }
    
    // Observer le bouton d'Ã©change
    const swapBtn = document.getElementById('swapLangs');
    if (swapBtn) {
        swapBtn.addEventListener('click', () => {
            setTimeout(saveCompletePageState, 200);
        });
    }
    
    // Observer les changements de taille de fenÃªtre
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(saveCompletePageState, 500);
    });
    
    // Sauvegarder avant de quitter la page
    window.addEventListener('beforeunload', saveCompletePageState);
    
    // Sauvegarder pÃ©riodiquement (toutes les 30 secondes)
    setInterval(saveCompletePageState, 30000);
}

// Modifier la gestion des onglets
function setupTabNavigationWithState() {
    const tabs = document.querySelectorAll('.tab');
    
    tabs.forEach(tab => {
        // Supprimer les anciens listeners
        const newTab = tab.cloneNode(true);
        tab.parentNode.replaceChild(newTab, tab);
    });
    
    // Re-sÃ©lectionner les tabs aprÃ¨s clonage
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            if (tabId === 'chatbot') {
                // Sauvegarder TOUT l'Ã©tat avant de quitter
                saveCompletePageState();
                
                // Attendre un peu pour s'assurer que tout est sauvegardÃ©
                setTimeout(() => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.getElementById('textTab').style.display = 'none';
                    document.getElementById('chatbotTab').style.display = 'block';
                    
                    setTimeout(() => {
                        document.getElementById('chatInput').focus();
                        if (document.getElementById('chatMessages').children.length === 0) {
                            addWelcomeMessage();
                        }
                    }, 100);
                }, 50);
                
            } else if (tabId === 'text') {
                // Restaurer TOUT l'Ã©tat avant d'afficher
                restoreCompletePageState();
                
                // Attendre que l'Ã©tat soit restaurÃ© avant d'afficher
                setTimeout(() => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.getElementById('chatbotTab').style.display = 'none';
                    document.getElementById('textTab').style.display = 'block';
                    
                    // Forcer le recalcul des dimensions
                    setTimeout(() => {
                        const inputTextarea = document.getElementById('inputText');
                        const outputTextarea = document.getElementById('outputText');
                        
                        if (inputTextarea) {
                            inputTextarea.style.height = 'auto';
                            setTimeout(() => {
                                if (pageState.inputHeight) {
                                    inputTextarea.style.height = pageState.inputHeight;
                                }
                            }, 10);
                        }
                        
                        if (outputTextarea) {
                            outputTextarea.style.height = 'auto';
                            setTimeout(() => {
                                if (pageState.outputHeight) {
                                    outputTextarea.style.height = pageState.outputHeight;
                                }
                            }, 10);
                        }
                        
                        // RÃ©appliquer les styles RTL
                        if (typeof applyRTLStyles === 'function') applyRTLStyles();
                    }, 100);
                }, 100);
            }
        });
    });
}

// Initialiser au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    // D'abord restaurer l'Ã©tat
    restoreCompletePageState();
    
    // Ensuite configurer l'observateur
    setTimeout(() => {
        setupStateObserver();
        setupTabNavigationWithState();
    }, 500);
    
    // Sauvegarder l'Ã©tat initial
    setTimeout(saveCompletePageState, 1000);
});

// Surcharger les fonctions existantes pour qu'elles sauvegardent l'Ã©tat
const originalTranslateText = window.translateText;
if (originalTranslateText) {
    window.translateText = function() {
        originalTranslateText.apply(this, arguments);
        setTimeout(saveCompletePageState, 300);
    };
}

const originalClearImage = window.clearImage;
if (originalClearImage) {
    window.clearImage = function() {
        originalClearImage.apply(this, arguments);
        setTimeout(saveCompletePageState, 300);
    };
}

const originalClearAllText = window.clearAllText;
if (originalClearAllText) {
    window.clearAllText = function() {
        originalClearAllText.apply(this, arguments);
        setTimeout(saveCompletePageState, 300);
    };
}

// Fonction pour rÃ©initialiser l'Ã©tat (optionnel)
function resetPageState() {
    localStorage.removeItem('linganora_complete_state');
    sessionStorage.removeItem('linganora_session_state');
    location.reload();
}
</script>
</body>
</html>